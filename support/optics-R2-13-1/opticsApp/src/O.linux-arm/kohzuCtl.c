/* C code for program kohzuCtl, generated by snc from ../kohzuCtl.st */
#include <string.h>
#include <stddef.h>
#include <stdio.h>
#include <limits.h>

#include "seq_snc.h"
# line 92 "../kohzuCtl.st"
static const EF_ID H_mon = 1;
# line 98 "../kohzuCtl.st"
static const EF_ID K_mon = 2;
# line 104 "../kohzuCtl.st"
static const EF_ID L_mon = 3;
# line 110 "../kohzuCtl.st"
static const EF_ID A_mon = 4;
# line 120 "../kohzuCtl.st"
static const EF_ID E_mon = 5;
# line 135 "../kohzuCtl.st"
static const EF_ID lambda_mon = 6;
# line 150 "../kohzuCtl.st"
static const EF_ID theta_mon = 7;
# line 231 "../kohzuCtl.st"
static const EF_ID thetaDmov_mon = 8;
# line 237 "../kohzuCtl.st"
static const EF_ID yDmov_mon = 9;
# line 243 "../kohzuCtl.st"
static const EF_ID zDmov_mon = 10;
# line 256 "../kohzuCtl.st"
short kohzuCtl_LS_TEST = 0;
# line 302 "../kohzuCtl.st"
static const EF_ID thetaMotHiLim_mon = 11;
# line 308 "../kohzuCtl.st"
static const EF_ID thetaMotLoLim_mon = 12;
# line 339 "../kohzuCtl.st"
static const EF_ID thetaMotCmdMon_mon = 13;
# line 345 "../kohzuCtl.st"
static const EF_ID yMotCmdMon_mon = 14;
# line 351 "../kohzuCtl.st"
static const EF_ID zMotCmdMon_mon = 15;
# line 360 "../kohzuCtl.st"
static const EF_ID thetaMotVel_mon = 16;
# line 369 "../kohzuCtl.st"
static const EF_ID yMotVel_mon = 17;
# line 378 "../kohzuCtl.st"
static const EF_ID zMotVel_mon = 18;
# line 388 "../kohzuCtl.st"
static const EF_ID thetaMotRdbk_mon = 19;
# line 390 "../kohzuCtl.st"
static const EF_ID thetaMotRdbkPseudo_mon = 20;
# line 395 "../kohzuCtl.st"
static const EF_ID yMotRdbk_mon = 21;
# line 401 "../kohzuCtl.st"
static const EF_ID zMotRdbk_mon = 22;
# line 408 "../kohzuCtl.st"
static const EF_ID useSetMode_mon = 23;
# line 414 "../kohzuCtl.st"
static const EF_ID thetaMotSet_mon = 24;
# line 420 "../kohzuCtl.st"
static const EF_ID yMotSet_mon = 25;
# line 426 "../kohzuCtl.st"
static const EF_ID zMotSet_mon = 26;
# line 470 "../kohzuCtl.st"
static const EF_ID yOffset_mon = 27;
# line 479 "../kohzuCtl.st"
#include <string.h>
# line 480 "../kohzuCtl.st"
#include <math.h>
# line 482 "../kohzuCtl.st"
double kohzuCtl_calc2dSpacing();
# line 483 "../kohzuCtl.st"
char *kohzuCtl_pmacP;
# line 484 "../kohzuCtl.st"
char *kohzuCtl_pmacM;
# line 485 "../kohzuCtl.st"
char *kohzuCtl_pmacGEOM;

/* Variable declarations */
# line 44 "../kohzuCtl.st"
static	short kohzuCtlDebug;
# line 48 "../kohzuCtl.st"
static	string seqMsg1;
# line 51 "../kohzuCtl.st"
static	string seqMsg2;
# line 54 "../kohzuCtl.st"
static	short opAlert;
# line 57 "../kohzuCtl.st"
static	short opAck;
# line 65 "../kohzuCtl.st"
static	short putVals;
# line 73 "../kohzuCtl.st"
static	short autoMode;
# line 78 "../kohzuCtl.st"
static	short ccMode;
# line 82 "../kohzuCtl.st"
static	short kohzuMoving;
# line 86 "../kohzuCtl.st"
static	short kohzuDone;
# line 89 "../kohzuCtl.st"
static	double H;
# line 95 "../kohzuCtl.st"
static	double K;
# line 101 "../kohzuCtl.st"
static	double L;
# line 107 "../kohzuCtl.st"
static	double A;
# line 113 "../kohzuCtl.st"
static	double D;
# line 117 "../kohzuCtl.st"
static	double E;
# line 123 "../kohzuCtl.st"
static	double EHi;
# line 126 "../kohzuCtl.st"
static	double ELo;
# line 129 "../kohzuCtl.st"
static	double ERdbk;
# line 132 "../kohzuCtl.st"
static	double lambda;
# line 138 "../kohzuCtl.st"
static	double lambdaHi;
# line 141 "../kohzuCtl.st"
static	double lambdaLo;
# line 144 "../kohzuCtl.st"
static	double lambdaRdbk;
# line 147 "../kohzuCtl.st"
static	double theta;
# line 153 "../kohzuCtl.st"
static	double thetaHi;
# line 156 "../kohzuCtl.st"
static	double thetaLo;
# line 159 "../kohzuCtl.st"
static	double thetaRdbk;
# line 168 "../kohzuCtl.st"
static	string thetaMotName;
# line 171 "../kohzuCtl.st"
static	string yMotName;
# line 174 "../kohzuCtl.st"
static	string zMotName;
# line 177 "../kohzuCtl.st"
static	double thetaMotCmdEcho;
# line 180 "../kohzuCtl.st"
static	double yMotCmdEcho;
# line 183 "../kohzuCtl.st"
static	double zMotCmdEcho;
# line 186 "../kohzuCtl.st"
static	double thetaMotRdbkEcho;
# line 189 "../kohzuCtl.st"
static	double yMotRdbkEcho;
# line 192 "../kohzuCtl.st"
static	double zMotRdbkEcho;
# line 195 "../kohzuCtl.st"
static	double thetaMotVelEcho;
# line 198 "../kohzuCtl.st"
static	double yMotVelEcho;
# line 201 "../kohzuCtl.st"
static	double zMotVelEcho;
# line 204 "../kohzuCtl.st"
static	short thetaDmovEcho;
# line 207 "../kohzuCtl.st"
static	short yDmovEcho;
# line 210 "../kohzuCtl.st"
static	short zDmovEcho;
# line 219 "../kohzuCtl.st"
static	short thetaMotStop;
# line 222 "../kohzuCtl.st"
static	short yStop;
# line 225 "../kohzuCtl.st"
static	short zStop;
# line 228 "../kohzuCtl.st"
static	short thetaDmov;
# line 234 "../kohzuCtl.st"
static	short yDmov;
# line 240 "../kohzuCtl.st"
static	short zDmov;
# line 247 "../kohzuCtl.st"
static	short thetaHls;
# line 248 "../kohzuCtl.st"
static	short thetaLls;
# line 249 "../kohzuCtl.st"
static	short yHls;
# line 250 "../kohzuCtl.st"
static	short yLls;
# line 251 "../kohzuCtl.st"
static	short zHls;
# line 252 "../kohzuCtl.st"
static	short zLls;
# line 283 "../kohzuCtl.st"
static	double thetaMotDesired;
# line 287 "../kohzuCtl.st"
static	double yMotDesired;
# line 290 "../kohzuCtl.st"
static	double yMotDesiredHi;
# line 292 "../kohzuCtl.st"
static	double yMotDesiredLo;
# line 295 "../kohzuCtl.st"
static	double zMotDesired;
# line 299 "../kohzuCtl.st"
static	double thetaMotHiLim;
# line 305 "../kohzuCtl.st"
static	double thetaMotLoLim;
# line 311 "../kohzuCtl.st"
static	double yMotHiLim;
# line 315 "../kohzuCtl.st"
static	double yMotLoLim;
# line 319 "../kohzuCtl.st"
static	double zMotHiLim;
# line 323 "../kohzuCtl.st"
static	double zMotLoLim;
# line 327 "../kohzuCtl.st"
static	double thetaMotCmd;
# line 330 "../kohzuCtl.st"
static	double yMotCmd;
# line 333 "../kohzuCtl.st"
static	double zMotCmd;
# line 336 "../kohzuCtl.st"
static	double thetaMotCmdMon;
# line 342 "../kohzuCtl.st"
static	double yMotCmdMon;
# line 348 "../kohzuCtl.st"
static	double zMotCmdMon;
# line 354 "../kohzuCtl.st"
static	double thTime;
# line 355 "../kohzuCtl.st"
static	double oldThSpeed;
# line 356 "../kohzuCtl.st"
static	double newThSpeed;
# line 357 "../kohzuCtl.st"
static	double thSpeed;
# line 363 "../kohzuCtl.st"
static	double yTime;
# line 364 "../kohzuCtl.st"
static	double oldYSpeed;
# line 365 "../kohzuCtl.st"
static	double newYSpeed;
# line 366 "../kohzuCtl.st"
static	double ySpeed;
# line 372 "../kohzuCtl.st"
static	double zTime;
# line 373 "../kohzuCtl.st"
static	double oldZSpeed;
# line 374 "../kohzuCtl.st"
static	double newZSpeed;
# line 375 "../kohzuCtl.st"
static	double zSpeed;
# line 381 "../kohzuCtl.st"
static	short speedControl;
# line 385 "../kohzuCtl.st"
static	double thetaMotRdbk;
# line 392 "../kohzuCtl.st"
static	double yMotRdbk;
# line 398 "../kohzuCtl.st"
static	double zMotRdbk;
# line 405 "../kohzuCtl.st"
static	short useSetMode;
# line 411 "../kohzuCtl.st"
static	short thetaMotSet;
# line 417 "../kohzuCtl.st"
static	short yMotSet;
# line 423 "../kohzuCtl.st"
static	short zMotSet;
# line 430 "../kohzuCtl.st"
static	double ETweakVal;
# line 434 "../kohzuCtl.st"
static	short ETweakInc;
# line 438 "../kohzuCtl.st"
static	short ETweakDec;
# line 442 "../kohzuCtl.st"
static	double LTweakVal;
# line 446 "../kohzuCtl.st"
static	short LTweakInc;
# line 450 "../kohzuCtl.st"
static	short LTweakDec;
# line 454 "../kohzuCtl.st"
static	double thTweakVal;
# line 458 "../kohzuCtl.st"
static	short thTweakInc;
# line 462 "../kohzuCtl.st"
static	short thTweakDec;
# line 467 "../kohzuCtl.st"
static	double yOffset;
# line 473 "../kohzuCtl.st"
static	double yOffsetHi;
# line 476 "../kohzuCtl.st"
static	double yOffsetLo;
# line 486 "../kohzuCtl.st"
static	short geom;
# line 488 "../kohzuCtl.st"
static	short causedMove;
# line 489 "../kohzuCtl.st"
static	short initSeq;
# line 490 "../kohzuCtl.st"
static	short initSeqDone;
# line 491 "../kohzuCtl.st"
static	float avg;
# line 492 "../kohzuCtl.st"
static	int nint;
# line 493 "../kohzuCtl.st"
static	double hc;
# line 494 "../kohzuCtl.st"
static	double radConv;
# line 495 "../kohzuCtl.st"
static	double temp;
# line 497 "../kohzuCtl.st"
static	int riskAverse;
# line 498 "../kohzuCtl.st"
static	double prev_E;
# line 499 "../kohzuCtl.st"
static	double prev_theta;
# line 500 "../kohzuCtl.st"
static	double prev_lambda;
# line 501 "../kohzuCtl.st"
static	double prev_thetaMotDesired;
# line 502 "../kohzuCtl.st"
static	double prev_yMotDesired;
# line 503 "../kohzuCtl.st"
static	double prev_zMotDesired;
# line 504 "../kohzuCtl.st"
static	int willViolateLimit;


/* Function declarations */

#define seqg_var (*(struct seqg_vars *const *)seqg_env)

/* Program init func */
static void seqg_init(PROG_ID seqg_env)
{
}

/****** Code for state "init" in state set "kohzuCtl" ******/

/* Event function for state "init" in state set "kohzuCtl" */
static seqBool seqg_event_kohzuCtl_0_init(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
	if (TRUE)
	{
		*seqg_pnst = 1;
		*seqg_ptrn = 0;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "init" in state set "kohzuCtl" */
static void seqg_action_kohzuCtl_0_init(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
# line 509 "../kohzuCtl.st"
			initSeq = 0;
# line 510 "../kohzuCtl.st"
			riskAverse = 0;
		}
		return;
	}
}

/****** Code for state "initSequence" in state set "kohzuCtl" ******/

/* Event function for state "initSequence" in state set "kohzuCtl" */
static seqBool seqg_event_kohzuCtl_0_initSequence(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
# line 515 "../kohzuCtl.st"
	if (initSeq == 0)
	{
		*seqg_pnst = 5;
		*seqg_ptrn = 0;
		return TRUE;
	}
# line 578 "../kohzuCtl.st"
	if (initSeq == 1)
	{
		*seqg_pnst = 15;
		*seqg_ptrn = 1;
		return TRUE;
	}
# line 583 "../kohzuCtl.st"
	if (initSeq == 2)
	{
		*seqg_pnst = 13;
		*seqg_ptrn = 2;
		return TRUE;
	}
# line 588 "../kohzuCtl.st"
	if ((initSeq == 3) && seq_delay(seqg_env, 1.))
	{
		*seqg_pnst = 9;
		*seqg_ptrn = 3;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "initSequence" in state set "kohzuCtl" */
static void seqg_action_kohzuCtl_0_initSequence(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
# line 516 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:initSequence:initSeq=0\n");
# line 517 "../kohzuCtl.st"
			hc = 12.3984244;
# line 518 "../kohzuCtl.st"
			radConv = 57.2958;
# line 519 "../kohzuCtl.st"
			thetaMotStop = 1;
# line 520 "../kohzuCtl.st"
			yStop = 1;
# line 521 "../kohzuCtl.st"
			zStop = 1;
# line 522 "../kohzuCtl.st"
			putVals = 0;
# line 523 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 5/*putVals*/, DEFAULT, DEFAULT_TIMEOUT);
# line 524 "../kohzuCtl.st"
			autoMode = 0;
# line 525 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 6/*autoMode*/, DEFAULT, DEFAULT_TIMEOUT);
# line 526 "../kohzuCtl.st"
			opAck = 0;
# line 527 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 4/*opAck*/, DEFAULT, DEFAULT_TIMEOUT);
			
  kohzuCtl_pmacP = seq_macValueGet(ssId,"P");
  kohzuCtl_pmacM = seq_macValueGet(ssId,"M_THETA");
  if (kohzuCtl_pmacP == 0 || kohzuCtl_pmacM == 0) {
   sprintf(thetaMotName,"??????");
  } else {
   strcpy(thetaMotName, kohzuCtl_pmacP);
   strcat(thetaMotName, kohzuCtl_pmacM);
  }
  kohzuCtl_pmacM = seq_macValueGet(ssId,"M_Y");
  if (kohzuCtl_pmacP == 0 || kohzuCtl_pmacM == 0) {
   sprintf(yMotName,"??????");
  } else {
   strcpy(yMotName, kohzuCtl_pmacP);
   strcat(yMotName, kohzuCtl_pmacM);
  }
  kohzuCtl_pmacM = seq_macValueGet(ssId,"M_Z");
  if (kohzuCtl_pmacP == 0 || kohzuCtl_pmacM == 0) {
   sprintf(zMotName,"??????");
  } else {
   strcpy(zMotName, kohzuCtl_pmacP);
   strcat(zMotName, kohzuCtl_pmacM);
  }
  kohzuCtl_pmacGEOM = seq_macValueGet(ssId,"GEOM");
  geom = 1;
  if (*kohzuCtl_pmacGEOM == '2') geom = 2;

# line 555 "../kohzuCtl.st"
			if (geom == 1)
			{
# line 556 "../kohzuCtl.st"
				yOffsetHi = 17.5 + .000001;
# line 557 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 91/*yOffsetHi*/, DEFAULT, DEFAULT_TIMEOUT);
# line 558 "../kohzuCtl.st"
				yOffsetLo = 17.5 - .000001;
# line 559 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 92/*yOffsetLo*/, DEFAULT, DEFAULT_TIMEOUT);
# line 560 "../kohzuCtl.st"
				yOffset = 17.5;
# line 561 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 90/*yOffset*/, DEFAULT, DEFAULT_TIMEOUT);
# line 562 "../kohzuCtl.st"
				yMotDesiredHi = 0.;
# line 563 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 55/*yMotDesiredHi*/, DEFAULT, DEFAULT_TIMEOUT);
# line 564 "../kohzuCtl.st"
				yMotDesiredLo = -35;
# line 565 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 56/*yMotDesiredLo*/, DEFAULT, DEFAULT_TIMEOUT);
			}
			else
			{
# line 567 "../kohzuCtl.st"
				yMotDesiredHi = 60.;
# line 568 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 55/*yMotDesiredHi*/, DEFAULT, DEFAULT_TIMEOUT);
# line 569 "../kohzuCtl.st"
				yMotDesiredLo = 0.;
# line 570 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 56/*yMotDesiredLo*/, DEFAULT, DEFAULT_TIMEOUT);
			}
# line 572 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 26/*thetaMotName*/, DEFAULT, DEFAULT_TIMEOUT);
# line 573 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 27/*yMotName*/, DEFAULT, DEFAULT_TIMEOUT);
# line 574 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 28/*zMotName*/, DEFAULT, DEFAULT_TIMEOUT);
# line 575 "../kohzuCtl.st"
			initSeq = 1;
		}
		return;
	case 1:
		{
# line 579 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:initSequence:initSeq=1\n");
# line 580 "../kohzuCtl.st"
			initSeq = 2;
		}
		return;
	case 2:
		{
# line 584 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:initSequence:initSeq=2\n");
# line 585 "../kohzuCtl.st"
			initSeq = 3;
		}
		return;
	case 3:
		{
# line 589 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:initSequence:initSeq=3\n");
# line 590 "../kohzuCtl.st"
			sprintf(seqMsg1, "Kohzu Control Ready");
# line 591 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 592 "../kohzuCtl.st"
			sprintf(seqMsg2, " ");
# line 593 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 2/*seqMsg2*/, DEFAULT, DEFAULT_TIMEOUT);
# line 594 "../kohzuCtl.st"
			initSeqDone = 1;
# line 595 "../kohzuCtl.st"
			theta = thetaMotRdbk;
# line 596 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 22/*theta*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	}
}

/****** Code for state "waitForCmndEnter" in state set "kohzuCtl" ******/

/* Event function for state "waitForCmndEnter" in state set "kohzuCtl" */
static seqBool seqg_event_kohzuCtl_0_waitForCmndEnter(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
# line 601 "../kohzuCtl.st"
	if (initSeqDone && seq_delay(seqg_env, .1))
	{
		*seqg_pnst = 3;
		*seqg_ptrn = 0;
		return TRUE;
	}
# line 661 "../kohzuCtl.st"
	if (!initSeqDone)
	{
		*seqg_pnst = 1;
		*seqg_ptrn = 1;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "waitForCmndEnter" in state set "kohzuCtl" */
static void seqg_action_kohzuCtl_0_waitForCmndEnter(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
# line 602 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:waitForCmndEnter:initSeqDone\n");
# line 603 "../kohzuCtl.st"
			seq_efClear(seqg_env, H_mon);
# line 604 "../kohzuCtl.st"
			seq_efClear(seqg_env, K_mon);
# line 605 "../kohzuCtl.st"
			seq_efClear(seqg_env, L_mon);
# line 606 "../kohzuCtl.st"
			seq_efClear(seqg_env, A_mon);
# line 607 "../kohzuCtl.st"
			seq_efClear(seqg_env, E_mon);
# line 608 "../kohzuCtl.st"
			seq_efClear(seqg_env, lambda_mon);
# line 609 "../kohzuCtl.st"
			seq_efClear(seqg_env, theta_mon);
# line 611 "../kohzuCtl.st"
			thetaMotRdbkEcho = thetaMotRdbk;
# line 612 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 32/*thetaMotRdbkEcho*/, DEFAULT, DEFAULT_TIMEOUT);
# line 613 "../kohzuCtl.st"
			yMotRdbkEcho = yMotRdbk;
# line 614 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 33/*yMotRdbkEcho*/, DEFAULT, DEFAULT_TIMEOUT);
# line 615 "../kohzuCtl.st"
			zMotRdbkEcho = zMotRdbk;
# line 616 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 34/*zMotRdbkEcho*/, DEFAULT, DEFAULT_TIMEOUT);
# line 617 "../kohzuCtl.st"
			thetaMotVelEcho = thSpeed;
# line 618 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 35/*thetaMotVelEcho*/, DEFAULT, DEFAULT_TIMEOUT);
# line 619 "../kohzuCtl.st"
			yMotVelEcho = ySpeed;
# line 620 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 36/*yMotVelEcho*/, DEFAULT, DEFAULT_TIMEOUT);
# line 621 "../kohzuCtl.st"
			zMotVelEcho = zSpeed;
# line 622 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 37/*zMotVelEcho*/, DEFAULT, DEFAULT_TIMEOUT);
# line 623 "../kohzuCtl.st"
			thetaMotCmdEcho = thetaMotCmdMon;
# line 624 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 29/*thetaMotCmdEcho*/, DEFAULT, DEFAULT_TIMEOUT);
# line 625 "../kohzuCtl.st"
			yMotCmdEcho = yMotCmdMon;
# line 626 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 30/*yMotCmdEcho*/, DEFAULT, DEFAULT_TIMEOUT);
# line 627 "../kohzuCtl.st"
			zMotCmdEcho = zMotCmdMon;
# line 628 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 31/*zMotCmdEcho*/, DEFAULT, DEFAULT_TIMEOUT);
# line 629 "../kohzuCtl.st"
			thetaDmovEcho = thetaDmov;
# line 630 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 38/*thetaDmovEcho*/, DEFAULT, DEFAULT_TIMEOUT);
# line 631 "../kohzuCtl.st"
			yDmovEcho = yDmov;
# line 632 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 39/*yDmovEcho*/, DEFAULT, DEFAULT_TIMEOUT);
# line 633 "../kohzuCtl.st"
			zDmovEcho = zDmov;
# line 634 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 40/*zDmovEcho*/, DEFAULT, DEFAULT_TIMEOUT);
# line 635 "../kohzuCtl.st"
			if (autoMode || useSetMode)
			{
# line 636 "../kohzuCtl.st"
				thetaRdbk = thetaMotRdbk;
# line 637 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 25/*thetaRdbk*/, DEFAULT, DEFAULT_TIMEOUT);
# line 638 "../kohzuCtl.st"
				lambdaRdbk = D * sin(thetaRdbk / radConv);
# line 639 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 21/*lambdaRdbk*/, DEFAULT, DEFAULT_TIMEOUT);
# line 640 "../kohzuCtl.st"
				ERdbk = hc / lambdaRdbk;
# line 641 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 17/*ERdbk*/, DEFAULT, DEFAULT_TIMEOUT);
			}
# line 643 "../kohzuCtl.st"
			opAck = 0;
# line 644 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 4/*opAck*/, DEFAULT, DEFAULT_TIMEOUT);
# line 645 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:waitForCmndEnter: kohzuMoving=%d; kohzuDone=%d\n", kohzuMoving, kohzuDone);
# line 646 "../kohzuCtl.st"
			if (kohzuMoving && kohzuDone)
			{
# line 647 "../kohzuCtl.st"
				if (kohzuCtlDebug)
					printf("kohzuCtl:waitForCmndEnter: asserting 'done'.\n");
# line 648 "../kohzuCtl.st"
				kohzuMoving = 0;
# line 648 "../kohzuCtl.st"
				kohzuDone = 0;
# line 649 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 8/*kohzuMoving*/, DEFAULT, DEFAULT_TIMEOUT);
			}
# line 652 "../kohzuCtl.st"
			prev_theta = theta;
# line 653 "../kohzuCtl.st"
			prev_E = E;
# line 654 "../kohzuCtl.st"
			prev_lambda = lambda;
# line 655 "../kohzuCtl.st"
			prev_thetaMotDesired = thetaMotDesired;
# line 656 "../kohzuCtl.st"
			prev_yMotDesired = yMotDesired;
# line 657 "../kohzuCtl.st"
			prev_zMotDesired = zMotDesired;
# line 658 "../kohzuCtl.st"
			willViolateLimit = 0;
		}
		return;
	case 1:
		{
		}
		return;
	}
}

/****** Code for state "waitForCmnd" in state set "kohzuCtl" ******/

/* Event function for state "waitForCmnd" in state set "kohzuCtl" */
static seqBool seqg_event_kohzuCtl_0_waitForCmnd(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
# line 666 "../kohzuCtl.st"
	if (seq_efTest(seqg_env, H_mon) || seq_efTest(seqg_env, K_mon) || seq_efTest(seqg_env, L_mon) || seq_efTest(seqg_env, A_mon))
	{
		*seqg_pnst = 5;
		*seqg_ptrn = 0;
		return TRUE;
	}
# line 678 "../kohzuCtl.st"
	if (seq_efTest(seqg_env, thetaMotHiLim_mon) || seq_efTest(seqg_env, thetaMotLoLim_mon))
	{
		*seqg_pnst = 6;
		*seqg_ptrn = 1;
		return TRUE;
	}
# line 688 "../kohzuCtl.st"
	if (seq_efTestAndClear(seqg_env, thetaMotRdbk_mon))
	{
		*seqg_pnst = 13;
		*seqg_ptrn = 2;
		return TRUE;
	}
# line 693 "../kohzuCtl.st"
	if (seq_efTestAndClear(seqg_env, E_mon))
	{
		*seqg_pnst = 7;
		*seqg_ptrn = 3;
		return TRUE;
	}
# line 697 "../kohzuCtl.st"
	if (seq_efTestAndClear(seqg_env, lambda_mon))
	{
		*seqg_pnst = 8;
		*seqg_ptrn = 4;
		return TRUE;
	}
# line 701 "../kohzuCtl.st"
	if (seq_efTestAndClear(seqg_env, theta_mon))
	{
		*seqg_pnst = 9;
		*seqg_ptrn = 5;
		return TRUE;
	}
# line 705 "../kohzuCtl.st"
	if (putVals && seq_delay(seqg_env, .1))
	{
		*seqg_pnst = 11;
		*seqg_ptrn = 6;
		return TRUE;
	}
# line 709 "../kohzuCtl.st"
	if (ETweakInc || ETweakDec || LTweakInc || LTweakDec || thTweakInc || thTweakDec)
	{
		*seqg_pnst = 4;
		*seqg_ptrn = 7;
		return TRUE;
	}
# line 713 "../kohzuCtl.st"
	if (seq_efTestAndClear(seqg_env, yOffset_mon))
	{
		*seqg_pnst = 10;
		*seqg_ptrn = 8;
		return TRUE;
	}
# line 723 "../kohzuCtl.st"
	if (opAck)
	{
		*seqg_pnst = 2;
		*seqg_ptrn = 9;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "waitForCmnd" in state set "kohzuCtl" */
static void seqg_action_kohzuCtl_0_waitForCmnd(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
# line 667 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:waitForCmnd:HKLA_mon\n");
# line 668 "../kohzuCtl.st"
			sprintf(seqMsg1, "Lattice Spacing Changed");
# line 669 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 670 "../kohzuCtl.st"
			sprintf(seqMsg2, " ");
# line 671 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 2/*seqMsg2*/, DEFAULT, DEFAULT_TIMEOUT);
# line 672 "../kohzuCtl.st"
			seq_efClear(seqg_env, H_mon);
# line 673 "../kohzuCtl.st"
			seq_efClear(seqg_env, K_mon);
# line 674 "../kohzuCtl.st"
			seq_efClear(seqg_env, L_mon);
# line 675 "../kohzuCtl.st"
			seq_efClear(seqg_env, A_mon);
		}
		return;
	case 1:
		{
# line 679 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:waitForCmnd:thetaMotXxLim_mon\n");
# line 680 "../kohzuCtl.st"
			sprintf(seqMsg1, "Theta Motor Soft Limits Changed");
# line 681 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 682 "../kohzuCtl.st"
			sprintf(seqMsg2, " ");
# line 683 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 2/*seqMsg2*/, DEFAULT, DEFAULT_TIMEOUT);
# line 684 "../kohzuCtl.st"
			seq_efClear(seqg_env, thetaMotHiLim_mon);
# line 685 "../kohzuCtl.st"
			seq_efClear(seqg_env, thetaMotLoLim_mon);
		}
		return;
	case 2:
		{
# line 689 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:waitForCmnd:thetaMotRdbk_mon\n");
# line 690 "../kohzuCtl.st"
			seq_efSet(seqg_env, thetaMotRdbkPseudo_mon);
		}
		return;
	case 3:
		{
# line 694 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:waitForCmnd:E_mon\n");
		}
		return;
	case 4:
		{
# line 698 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:waitForCmnd:lambda_mon\n");
		}
		return;
	case 5:
		{
# line 702 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:waitForCmnd:theta_mon\n");
		}
		return;
	case 6:
		{
# line 706 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:waitForCmnd:putVals\n");
		}
		return;
	case 7:
		{
# line 710 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:waitForCmnd:Tweak\n");
		}
		return;
	case 8:
		{
# line 714 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:waitForCmnd:yOffset_mon\n");
# line 715 "../kohzuCtl.st"
			autoMode = 0;
# line 716 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 6/*autoMode*/, DEFAULT, DEFAULT_TIMEOUT);
# line 717 "../kohzuCtl.st"
			sprintf(seqMsg1, "y offset changed to %f", yOffset);
# line 718 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 719 "../kohzuCtl.st"
			sprintf(seqMsg2, "Set to Manual Mode");
# line 720 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 2/*seqMsg2*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	case 9:
		{
# line 724 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:waitForCmnd:opAck\n");
# line 725 "../kohzuCtl.st"
			opAlert = 0;
# line 726 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 3/*opAlert*/, DEFAULT, DEFAULT_TIMEOUT);
# line 727 "../kohzuCtl.st"
			sprintf(seqMsg1, " ");
# line 728 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 729 "../kohzuCtl.st"
			sprintf(seqMsg2, " ");
# line 730 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 2/*seqMsg2*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	}
}

/****** Code for state "tweak" in state set "kohzuCtl" ******/

/* Event function for state "tweak" in state set "kohzuCtl" */
static seqBool seqg_event_kohzuCtl_0_tweak(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
# line 735 "../kohzuCtl.st"
	if (ETweakInc || ETweakDec)
	{
		*seqg_pnst = 7;
		*seqg_ptrn = 0;
		return TRUE;
	}
# line 756 "../kohzuCtl.st"
	if (LTweakInc || LTweakDec)
	{
		*seqg_pnst = 8;
		*seqg_ptrn = 1;
		return TRUE;
	}
# line 777 "../kohzuCtl.st"
	if (thTweakInc || thTweakDec)
	{
		*seqg_pnst = 9;
		*seqg_ptrn = 2;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "tweak" in state set "kohzuCtl" */
static void seqg_action_kohzuCtl_0_tweak(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
# line 736 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:tweak:E+\n");
# line 737 "../kohzuCtl.st"
			temp = E + ETweakVal * (ETweakInc ? 1 : -1);
# line 738 "../kohzuCtl.st"
			if ((temp >= ELo) && (temp <= EHi))
			{
# line 739 "../kohzuCtl.st"
				E = temp;
# line 740 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 14/*E*/, DEFAULT, DEFAULT_TIMEOUT);
			}
			else
			{
# line 742 "../kohzuCtl.st"
				sprintf(seqMsg1, "E tweak exceeds limit");
# line 743 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 744 "../kohzuCtl.st"
				opAlert = 1;
# line 745 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 3/*opAlert*/, DEFAULT, DEFAULT_TIMEOUT);
			}
# line 747 "../kohzuCtl.st"
			if (ETweakInc)
			{
# line 748 "../kohzuCtl.st"
				ETweakInc = 0;
# line 749 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 82/*ETweakInc*/, DEFAULT, DEFAULT_TIMEOUT);
			}
			else
			{
# line 751 "../kohzuCtl.st"
				ETweakDec = 0;
# line 752 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 83/*ETweakDec*/, DEFAULT, DEFAULT_TIMEOUT);
			}
		}
		return;
	case 1:
		{
# line 757 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:tweak:L\n");
# line 758 "../kohzuCtl.st"
			temp = lambda + LTweakVal * (LTweakInc ? 1 : -1);
# line 759 "../kohzuCtl.st"
			if ((temp >= lambdaLo) && (temp <= lambdaHi))
			{
# line 760 "../kohzuCtl.st"
				lambda = temp;
# line 761 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 18/*lambda*/, DEFAULT, DEFAULT_TIMEOUT);
			}
			else
			{
# line 763 "../kohzuCtl.st"
				sprintf(seqMsg1, "Lambda tweak exceeds limit");
# line 764 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 765 "../kohzuCtl.st"
				opAlert = 1;
# line 766 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 3/*opAlert*/, DEFAULT, DEFAULT_TIMEOUT);
			}
# line 768 "../kohzuCtl.st"
			if (LTweakInc)
			{
# line 769 "../kohzuCtl.st"
				LTweakInc = 0;
# line 770 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 85/*LTweakInc*/, DEFAULT, DEFAULT_TIMEOUT);
			}
			else
			{
# line 772 "../kohzuCtl.st"
				LTweakDec = 0;
# line 773 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 86/*LTweakDec*/, DEFAULT, DEFAULT_TIMEOUT);
			}
		}
		return;
	case 2:
		{
# line 778 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:tweak:th\n");
# line 779 "../kohzuCtl.st"
			temp = theta + thTweakVal * (thTweakInc ? 1 : -1);
# line 780 "../kohzuCtl.st"
			if ((temp >= thetaLo) && (temp <= thetaHi))
			{
# line 781 "../kohzuCtl.st"
				theta = temp;
# line 782 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 22/*theta*/, DEFAULT, DEFAULT_TIMEOUT);
			}
			else
			{
# line 784 "../kohzuCtl.st"
				sprintf(seqMsg1, "Theta tweak exceeds limit");
# line 785 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 786 "../kohzuCtl.st"
				opAlert = 1;
# line 787 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 3/*opAlert*/, DEFAULT, DEFAULT_TIMEOUT);
			}
# line 789 "../kohzuCtl.st"
			if (thTweakInc)
			{
# line 790 "../kohzuCtl.st"
				thTweakInc = 0;
# line 791 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 88/*thTweakInc*/, DEFAULT, DEFAULT_TIMEOUT);
			}
			else
			{
# line 793 "../kohzuCtl.st"
				thTweakDec = 0;
# line 794 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 89/*thTweakDec*/, DEFAULT, DEFAULT_TIMEOUT);
			}
		}
		return;
	}
}

/****** Code for state "dInputChanged" in state set "kohzuCtl" ******/

/* Event function for state "dInputChanged" in state set "kohzuCtl" */
static seqBool seqg_event_kohzuCtl_0_dInputChanged(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
	if (TRUE)
	{
		*seqg_pnst = 9;
		*seqg_ptrn = 0;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "dInputChanged" in state set "kohzuCtl" */
static void seqg_action_kohzuCtl_0_dInputChanged(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
# line 801 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:dInputChanged\n");
# line 802 "../kohzuCtl.st"
			autoMode = 0;
# line 803 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 6/*autoMode*/, DEFAULT, DEFAULT_TIMEOUT);
# line 804 "../kohzuCtl.st"
			sprintf(seqMsg2, "Set to Manual Mode");
# line 805 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 2/*seqMsg2*/, DEFAULT, DEFAULT_TIMEOUT);
# line 806 "../kohzuCtl.st"
			D = kohzuCtl_calc2dSpacing();
# line 807 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 13/*D*/, DEFAULT, DEFAULT_TIMEOUT);
# line 808 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 809 "../kohzuCtl.st"
			lambdaHi = D * sin(thetaHi / radConv);
# line 810 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 19/*lambdaHi*/, DEFAULT, DEFAULT_TIMEOUT);
# line 811 "../kohzuCtl.st"
			lambdaLo = D * sin(thetaLo / radConv);
# line 812 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 20/*lambdaLo*/, DEFAULT, DEFAULT_TIMEOUT);
# line 813 "../kohzuCtl.st"
			EHi = hc / lambdaLo;
# line 814 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 15/*EHi*/, DEFAULT, DEFAULT_TIMEOUT);
# line 815 "../kohzuCtl.st"
			ELo = hc / lambdaHi;
# line 816 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 16/*ELo*/, DEFAULT, DEFAULT_TIMEOUT);
# line 817 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 3/*opAlert*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	}
}

/****** Code for state "thetaLimits" in state set "kohzuCtl" ******/

/* Event function for state "thetaLimits" in state set "kohzuCtl" */
static seqBool seqg_event_kohzuCtl_0_thetaLimits(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
	if (TRUE)
	{
		*seqg_pnst = 12;
		*seqg_ptrn = 0;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "thetaLimits" in state set "kohzuCtl" */
static void seqg_action_kohzuCtl_0_thetaLimits(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
# line 823 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:thetaLimits\n");
# line 824 "../kohzuCtl.st"
			thetaHi = thetaMotHiLim;
# line 825 "../kohzuCtl.st"
			thetaLo = thetaMotLoLim;
# line 826 "../kohzuCtl.st"
			if (thetaHi > 89.0)
			{
# line 827 "../kohzuCtl.st"
				thetaHi = 89.0;
# line 828 "../kohzuCtl.st"
				sprintf(seqMsg2, "ThetaHiLim > 89 deg. (Using 89 deg.)");
# line 829 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 2/*seqMsg2*/, DEFAULT, DEFAULT_TIMEOUT);
			}
# line 831 "../kohzuCtl.st"
			if (thetaLo < 1.0)
			{
# line 832 "../kohzuCtl.st"
				thetaLo = 1.0;
# line 833 "../kohzuCtl.st"
				sprintf(seqMsg2, "ThetaLoLim < 1 deg. (Using 1 deg.)");
# line 834 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 2/*seqMsg2*/, DEFAULT, DEFAULT_TIMEOUT);
			}
# line 836 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 23/*thetaHi*/, DEFAULT, DEFAULT_TIMEOUT);
# line 837 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 24/*thetaLo*/, DEFAULT, DEFAULT_TIMEOUT);
# line 838 "../kohzuCtl.st"
			lambdaHi = D * sin(thetaHi / radConv);
# line 839 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 19/*lambdaHi*/, DEFAULT, DEFAULT_TIMEOUT);
# line 840 "../kohzuCtl.st"
			lambdaLo = D * sin(thetaLo / radConv);
# line 841 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 20/*lambdaLo*/, DEFAULT, DEFAULT_TIMEOUT);
# line 842 "../kohzuCtl.st"
			EHi = hc / lambdaLo;
# line 843 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 15/*EHi*/, DEFAULT, DEFAULT_TIMEOUT);
# line 844 "../kohzuCtl.st"
			ELo = hc / lambdaHi;
# line 845 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 16/*ELo*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	}
}

/****** Code for state "eChanged" in state set "kohzuCtl" ******/

/* Event function for state "eChanged" in state set "kohzuCtl" */
static seqBool seqg_event_kohzuCtl_0_eChanged(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
	if (TRUE)
	{
		*seqg_pnst = 8;
		*seqg_ptrn = 0;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "eChanged" in state set "kohzuCtl" */
static void seqg_action_kohzuCtl_0_eChanged(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
# line 851 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:eChanged\n");
# line 852 "../kohzuCtl.st"
			lambda = hc / E;
# line 853 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 18/*lambda*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	}
}

/****** Code for state "lChanged" in state set "kohzuCtl" ******/

/* Event function for state "lChanged" in state set "kohzuCtl" */
static seqBool seqg_event_kohzuCtl_0_lChanged(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
# line 858 "../kohzuCtl.st"
	if (lambda > D)
	{
		*seqg_pnst = 9;
		*seqg_ptrn = 0;
		return TRUE;
	}
	if (TRUE)
	{
		*seqg_pnst = 9;
		*seqg_ptrn = 1;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "lChanged" in state set "kohzuCtl" */
static void seqg_action_kohzuCtl_0_lChanged(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
# line 859 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:lChanged: lambda>D\n");
# line 861 "../kohzuCtl.st"
			sprintf(seqMsg1, "Wavelength > 2d spacing.");
# line 862 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 863 "../kohzuCtl.st"
			opAlert = 1;
# line 864 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 3/*opAlert*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	case 1:
		{
# line 868 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:lChanged\n");
# line 869 "../kohzuCtl.st"
			theta = radConv * asin(lambda / D);
# line 870 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 22/*theta*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	}
}

/****** Code for state "thChanged" in state set "kohzuCtl" ******/

/* Event function for state "thChanged" in state set "kohzuCtl" */
static seqBool seqg_event_kohzuCtl_0_thChanged(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
	if (TRUE)
	{
		*seqg_pnst = 10;
		*seqg_ptrn = 0;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "thChanged" in state set "kohzuCtl" */
static void seqg_action_kohzuCtl_0_thChanged(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
# line 876 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:thChanged\n");
# line 877 "../kohzuCtl.st"
			if ((theta <= thetaLo) || (theta >= thetaHi))
			{
# line 878 "../kohzuCtl.st"
				sprintf(seqMsg1, "Theta constrained to LIMIT");
# line 879 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 880 "../kohzuCtl.st"
				opAlert = 1;
# line 881 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 3/*opAlert*/, DEFAULT, DEFAULT_TIMEOUT);
# line 882 "../kohzuCtl.st"
				if (theta < thetaLo)
# line 882 "../kohzuCtl.st"
					theta = thetaLo;
# line 883 "../kohzuCtl.st"
				if (theta > thetaHi)
# line 883 "../kohzuCtl.st"
					theta = thetaHi;
# line 884 "../kohzuCtl.st"
				if (riskAverse)
				{
# line 885 "../kohzuCtl.st"
					autoMode = 0;
# line 886 "../kohzuCtl.st"
					seq_pvPutTmo(seqg_env, 6/*autoMode*/, DEFAULT, DEFAULT_TIMEOUT);
# line 887 "../kohzuCtl.st"
					sprintf(seqMsg2, "Set to Manual Mode");
# line 888 "../kohzuCtl.st"
					seq_pvPutTmo(seqg_env, 2/*seqMsg2*/, DEFAULT, DEFAULT_TIMEOUT);
				}
				else
				{
# line 890 "../kohzuCtl.st"
					willViolateLimit = 1;
				}
			}
# line 893 "../kohzuCtl.st"
			lambda = D * sin(theta / radConv);
# line 894 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 18/*lambda*/, DEFAULT, DEFAULT_TIMEOUT);
# line 895 "../kohzuCtl.st"
			E = hc / lambda;
# line 896 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 14/*E*/, DEFAULT, DEFAULT_TIMEOUT);
# line 899 "../kohzuCtl.st"
			thetaRdbk = thetaMotRdbk;
# line 900 "../kohzuCtl.st"
			lambdaRdbk = D * sin(thetaRdbk / radConv);
# line 901 "../kohzuCtl.st"
			ERdbk = hc / lambdaRdbk;
# line 902 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 25/*thetaRdbk*/, DEFAULT, DEFAULT_TIMEOUT);
# line 903 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 21/*lambdaRdbk*/, DEFAULT, DEFAULT_TIMEOUT);
# line 904 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 17/*ERdbk*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	}
}

/****** Code for state "calcMovements" in state set "kohzuCtl" ******/

/* Event function for state "calcMovements" in state set "kohzuCtl" */
static seqBool seqg_event_kohzuCtl_0_calcMovements(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
	if (TRUE)
	{
		*seqg_pnst = 11;
		*seqg_ptrn = 0;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "calcMovements" in state set "kohzuCtl" */
static void seqg_action_kohzuCtl_0_calcMovements(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
# line 910 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:calcMovements\n");
# line 913 "../kohzuCtl.st"
			thetaMotDesired = theta;
# line 914 "../kohzuCtl.st"
			if (geom == 1)
			{
# line 915 "../kohzuCtl.st"
				yMotDesired = -yOffset / cos(theta / radConv);
# line 916 "../kohzuCtl.st"
				zMotDesired = yOffset / sin(theta / radConv);
			}
			else
			{
# line 918 "../kohzuCtl.st"
				yMotDesired = yOffset / (2 * cos(theta / radConv));
# line 919 "../kohzuCtl.st"
				zMotDesired = yOffset / (2 * sin(theta / radConv));
			}
# line 921 "../kohzuCtl.st"
			if (ccMode != 1 && ccMode != 3 && ((yMotDesired < yMotLoLim) || (yMotDesired > yMotHiLim)))
			{
# line 923 "../kohzuCtl.st"
				sprintf(seqMsg1, "Y will exceed soft limits");
# line 924 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 925 "../kohzuCtl.st"
				opAlert = 1;
# line 926 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 3/*opAlert*/, DEFAULT, DEFAULT_TIMEOUT);
# line 927 "../kohzuCtl.st"
				if (riskAverse)
				{
# line 928 "../kohzuCtl.st"
					sprintf(seqMsg2, "Setting to Manual Mode");
# line 929 "../kohzuCtl.st"
					seq_pvPutTmo(seqg_env, 2/*seqMsg2*/, DEFAULT, DEFAULT_TIMEOUT);
# line 930 "../kohzuCtl.st"
					opAlert = 1;
# line 931 "../kohzuCtl.st"
					seq_pvPutTmo(seqg_env, 3/*opAlert*/, DEFAULT, DEFAULT_TIMEOUT);
# line 932 "../kohzuCtl.st"
					autoMode = 0;
# line 933 "../kohzuCtl.st"
					seq_pvPutTmo(seqg_env, 6/*autoMode*/, DEFAULT, DEFAULT_TIMEOUT);
				}
				else
				{
# line 935 "../kohzuCtl.st"
					willViolateLimit = 1;
				}
			}
# line 938 "../kohzuCtl.st"
			if (ccMode != 1 && ccMode != 2 && ((zMotDesired < zMotLoLim) || (zMotDesired > zMotHiLim)))
			{
# line 940 "../kohzuCtl.st"
				sprintf(seqMsg1, "Z will exceed soft limits");
# line 941 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 942 "../kohzuCtl.st"
				opAlert = 1;
# line 943 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 3/*opAlert*/, DEFAULT, DEFAULT_TIMEOUT);
# line 944 "../kohzuCtl.st"
				if (riskAverse)
				{
# line 945 "../kohzuCtl.st"
					sprintf(seqMsg2, "Setting to Manual Mode");
# line 946 "../kohzuCtl.st"
					seq_pvPutTmo(seqg_env, 2/*seqMsg2*/, DEFAULT, DEFAULT_TIMEOUT);
# line 947 "../kohzuCtl.st"
					opAlert = 1;
# line 948 "../kohzuCtl.st"
					seq_pvPutTmo(seqg_env, 3/*opAlert*/, DEFAULT, DEFAULT_TIMEOUT);
# line 949 "../kohzuCtl.st"
					autoMode = 0;
# line 950 "../kohzuCtl.st"
					seq_pvPutTmo(seqg_env, 6/*autoMode*/, DEFAULT, DEFAULT_TIMEOUT);
				}
				else
				{
# line 952 "../kohzuCtl.st"
					willViolateLimit = 1;
				}
			}
# line 955 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 53/*thetaMotDesired*/, DEFAULT, DEFAULT_TIMEOUT);
# line 956 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 54/*yMotDesired*/, DEFAULT, DEFAULT_TIMEOUT);
# line 957 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 57/*zMotDesired*/, DEFAULT, DEFAULT_TIMEOUT);
# line 960 "../kohzuCtl.st"
			oldThSpeed = thSpeed;
# line 961 "../kohzuCtl.st"
			oldYSpeed = ySpeed;
# line 962 "../kohzuCtl.st"
			oldZSpeed = zSpeed;
# line 963 "../kohzuCtl.st"
			thTime = fabs(theta - thetaMotRdbk) / thSpeed;
# line 964 "../kohzuCtl.st"
			yTime = fabs(yMotDesired - yMotRdbk) / ySpeed;
# line 965 "../kohzuCtl.st"
			zTime = fabs(zMotDesired - zMotRdbk) / zSpeed;
# line 967 "../kohzuCtl.st"
			if (ccMode == 1)
			{
# line 969 "../kohzuCtl.st"
				yTime = 0.0;
# line 970 "../kohzuCtl.st"
				zTime = 0.0;
			}
			else
# line 971 "../kohzuCtl.st"
				if (ccMode == 2)
				{
# line 973 "../kohzuCtl.st"
					zTime = 0.0;
				}
				else
# line 974 "../kohzuCtl.st"
					if (ccMode == 3)
					{
# line 976 "../kohzuCtl.st"
						yTime = 0.0;
					}
# line 979 "../kohzuCtl.st"
			if ((thTime >= yTime) && (thTime >= zTime))
			{
# line 980 "../kohzuCtl.st"
				newThSpeed = thSpeed;
# line 981 "../kohzuCtl.st"
				newYSpeed = fabs(yMotDesired - yMotRdbk) / thTime;
# line 982 "../kohzuCtl.st"
				newZSpeed = fabs(zMotDesired - zMotRdbk) / thTime;
			}
			else
# line 983 "../kohzuCtl.st"
				if ((yTime >= thTime) && (yTime >= zTime))
				{
# line 984 "../kohzuCtl.st"
					newThSpeed = fabs(theta - thetaMotRdbk) / yTime;
# line 985 "../kohzuCtl.st"
					newYSpeed = ySpeed;
# line 986 "../kohzuCtl.st"
					newZSpeed = fabs(zMotDesired - zMotRdbk) / yTime;
				}
				else
				{
# line 988 "../kohzuCtl.st"
					newThSpeed = fabs(theta - thetaMotRdbk) / zTime;
# line 989 "../kohzuCtl.st"
					newYSpeed = fabs(yMotDesired - yMotRdbk) / zTime;
# line 990 "../kohzuCtl.st"
					newZSpeed = zSpeed;
				}
		}
		return;
	}
}

/****** Code for state "moveKohzu" in state set "kohzuCtl" ******/

/* Event function for state "moveKohzu" in state set "kohzuCtl" */
static seqBool seqg_event_kohzuCtl_0_moveKohzu(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
# line 997 "../kohzuCtl.st"
	if (autoMode || putVals || useSetMode)
	{
		*seqg_pnst = 13;
		*seqg_ptrn = 0;
		return TRUE;
	}
# line 1047 "../kohzuCtl.st"
	if (1)
	{
		*seqg_pnst = 2;
		*seqg_ptrn = 1;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "moveKohzu" in state set "kohzuCtl" */
static void seqg_action_kohzuCtl_0_moveKohzu(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
# line 998 "../kohzuCtl.st"
			if (willViolateLimit)
			{
# line 999 "../kohzuCtl.st"
				E = prev_E;
# line 1000 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 14/*E*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1001 "../kohzuCtl.st"
				theta = prev_theta;
# line 1002 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 22/*theta*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1003 "../kohzuCtl.st"
				lambda = prev_lambda;
# line 1004 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 18/*lambda*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1005 "../kohzuCtl.st"
				thetaMotDesired = prev_thetaMotDesired;
# line 1006 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 53/*thetaMotDesired*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1007 "../kohzuCtl.st"
				yMotDesired = prev_yMotDesired;
# line 1008 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 54/*yMotDesired*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1009 "../kohzuCtl.st"
				zMotDesired = prev_zMotDesired;
# line 1010 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 57/*zMotDesired*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1011 "../kohzuCtl.st"
				sprintf(seqMsg2, "Command ignored");
# line 1012 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 2/*seqMsg2*/, DEFAULT, DEFAULT_TIMEOUT);
			}
			else
			{
# line 1014 "../kohzuCtl.st"
				if (kohzuCtlDebug)
					printf("kohzuCtl:moveKohzu:auto|put\n");
# line 1015 "../kohzuCtl.st"
				if (speedControl)
				{
# line 1016 "../kohzuCtl.st"
					thSpeed = newThSpeed;
# line 1017 "../kohzuCtl.st"
					ySpeed = newYSpeed;
# line 1018 "../kohzuCtl.st"
					zSpeed = newZSpeed;
# line 1019 "../kohzuCtl.st"
					seq_pvPutTmo(seqg_env, 70/*thSpeed*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1020 "../kohzuCtl.st"
					if (ccMode == 0 || ccMode == 2)
					{
# line 1021 "../kohzuCtl.st"
						seq_pvPutTmo(seqg_env, 71/*ySpeed*/, DEFAULT, DEFAULT_TIMEOUT);
					}
# line 1023 "../kohzuCtl.st"
					if (ccMode == 0 || ccMode == 3)
					{
# line 1024 "../kohzuCtl.st"
						seq_pvPutTmo(seqg_env, 72/*zSpeed*/, DEFAULT, DEFAULT_TIMEOUT);
					}
				}
# line 1027 "../kohzuCtl.st"
				thetaMotCmd = thetaMotDesired;
# line 1028 "../kohzuCtl.st"
				yMotCmd = yMotDesired;
# line 1029 "../kohzuCtl.st"
				zMotCmd = zMotDesired;
# line 1030 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 64/*thetaMotCmd*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1031 "../kohzuCtl.st"
				if (ccMode == 0)
				{
# line 1032 "../kohzuCtl.st"
					seq_pvPutTmo(seqg_env, 65/*yMotCmd*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1033 "../kohzuCtl.st"
					seq_pvPutTmo(seqg_env, 66/*zMotCmd*/, DEFAULT, DEFAULT_TIMEOUT);
				}
				else
# line 1034 "../kohzuCtl.st"
					if (ccMode == 1)
					{
# line 1035 "../kohzuCtl.st"
						;
					}
					else
# line 1036 "../kohzuCtl.st"
						if (ccMode == 2)
						{
# line 1037 "../kohzuCtl.st"
							seq_pvPutTmo(seqg_env, 65/*yMotCmd*/, DEFAULT, DEFAULT_TIMEOUT);
						}
						else
# line 1038 "../kohzuCtl.st"
							if (ccMode == 3)
							{
# line 1039 "../kohzuCtl.st"
								seq_pvPutTmo(seqg_env, 66/*zMotCmd*/, DEFAULT, DEFAULT_TIMEOUT);
							}
# line 1041 "../kohzuCtl.st"
				putVals = 0;
# line 1042 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 5/*putVals*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1043 "../kohzuCtl.st"
				causedMove = 1;
			}
		}
		return;
	case 1:
		{
# line 1048 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:moveKohzu\n");
		}
		return;
	}
}

/****** Code for state "checkDone" in state set "kohzuCtl" ******/

/* Event function for state "checkDone" in state set "kohzuCtl" */
static seqBool seqg_event_kohzuCtl_0_checkDone(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
# line 1053 "../kohzuCtl.st"
	if (thetaDmov && yDmov && zDmov)
	{
		*seqg_pnst = 2;
		*seqg_ptrn = 0;
		return TRUE;
	}
# line 1058 "../kohzuCtl.st"
	if (!thetaDmov || !yDmov || !zDmov)
	{
		*seqg_pnst = 13;
		*seqg_ptrn = 1;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "checkDone" in state set "kohzuCtl" */
static void seqg_action_kohzuCtl_0_checkDone(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
# line 1054 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:checkDone: done\n");
# line 1055 "../kohzuCtl.st"
			kohzuDone = 1;
		}
		return;
	case 1:
		{
# line 1059 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:checkDone: not done\n");
		}
		return;
	}
}

/****** Code for state "updateRdbk" in state set "kohzuCtl" ******/

/* Event function for state "updateRdbk" in state set "kohzuCtl" */
static seqBool seqg_event_kohzuCtl_0_updateRdbk(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
# line 1065 "../kohzuCtl.st"
	if (willViolateLimit == 1)
	{
		*seqg_pnst = 2;
		*seqg_ptrn = 0;
		return TRUE;
	}
# line 1068 "../kohzuCtl.st"
	if (thetaMotRdbk == 0)
	{
		*seqg_pnst = 2;
		*seqg_ptrn = 1;
		return TRUE;
	}
# line 1079 "../kohzuCtl.st"
	if (thetaDmov && yDmov && zDmov && seq_delay(seqg_env, 0.01))
	{
		*seqg_pnst = 14;
		*seqg_ptrn = 2;
		return TRUE;
	}
# line 1094 "../kohzuCtl.st"
	if (thetaHls || thetaLls)
	{
		*seqg_pnst = 17;
		*seqg_ptrn = 3;
		return TRUE;
	}
# line 1107 "../kohzuCtl.st"
	if ((ccMode != 1) && (ccMode != 3) && (yHls || yLls))
	{
		*seqg_pnst = 17;
		*seqg_ptrn = 4;
		return TRUE;
	}
# line 1120 "../kohzuCtl.st"
	if ((ccMode != 1) && (ccMode != 2) && (zHls || zLls))
	{
		*seqg_pnst = 17;
		*seqg_ptrn = 5;
		return TRUE;
	}
# line 1132 "../kohzuCtl.st"
	if ((!thetaDmov || !yDmov || !zDmov) && seq_delay(seqg_env, .1))
	{
		*seqg_pnst = 13;
		*seqg_ptrn = 6;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "updateRdbk" in state set "kohzuCtl" */
static void seqg_action_kohzuCtl_0_updateRdbk(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
		}
		return;
	case 1:
		{
# line 1069 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:updateRdbk:thetaMotRdbk==0\n");
# line 1070 "../kohzuCtl.st"
			sprintf(seqMsg1, "Theta Motor Readback is 0 !");
# line 1071 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1072 "../kohzuCtl.st"
			sprintf(seqMsg2, "Monochromator stopped");
# line 1073 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 2/*seqMsg2*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1074 "../kohzuCtl.st"
			opAlert = 1;
# line 1075 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 3/*opAlert*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	case 2:
		{
# line 1080 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:updateRdbk:*Dmov (done=%d,moving=%d)\n", kohzuDone, kohzuMoving);
# line 1081 "../kohzuCtl.st"
			thetaRdbk = thetaMotRdbk;
# line 1082 "../kohzuCtl.st"
			lambdaRdbk = D * sin(thetaRdbk / radConv);
# line 1083 "../kohzuCtl.st"
			ERdbk = hc / lambdaRdbk;
# line 1084 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 25/*thetaRdbk*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1085 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 21/*lambdaRdbk*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1086 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 17/*ERdbk*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1087 "../kohzuCtl.st"
			kohzuDone = 1;
# line 1088 "../kohzuCtl.st"
			seq_efSet(seqg_env, thetaMotRdbkPseudo_mon);
# line 1089 "../kohzuCtl.st"
			seq_efClear(seqg_env, thetaMotRdbk_mon);
# line 1090 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:updateRdbk: done\n");
		}
		return;
	case 3:
		{
# line 1095 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:updateRdbk: Th limit switch\n");
# line 1096 "../kohzuCtl.st"
			sprintf(seqMsg1, "Theta Motor hit a limit switch!");
# line 1097 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1098 "../kohzuCtl.st"
			opAlert = 1;
# line 1099 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 3/*opAlert*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1100 "../kohzuCtl.st"
			autoMode = 0;
# line 1101 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 6/*autoMode*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1102 "../kohzuCtl.st"
			sprintf(seqMsg2, "Setting to Manual Mode");
# line 1103 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 2/*seqMsg2*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	case 4:
		{
# line 1108 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:updateRdbk: Y limit switch\n");
# line 1109 "../kohzuCtl.st"
			sprintf(seqMsg1, "Y Motor hit a limit switch!");
# line 1110 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1111 "../kohzuCtl.st"
			opAlert = 1;
# line 1112 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 3/*opAlert*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1113 "../kohzuCtl.st"
			autoMode = 0;
# line 1114 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 6/*autoMode*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1115 "../kohzuCtl.st"
			sprintf(seqMsg2, "Setting to Manual Mode");
# line 1116 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 2/*seqMsg2*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	case 5:
		{
# line 1121 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:updateRdbk: Z limit switch\n");
# line 1122 "../kohzuCtl.st"
			sprintf(seqMsg1, "Z Motor hit a limit switch!");
# line 1123 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1124 "../kohzuCtl.st"
			opAlert = 1;
# line 1125 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 3/*opAlert*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1126 "../kohzuCtl.st"
			autoMode = 0;
# line 1127 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 6/*autoMode*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1128 "../kohzuCtl.st"
			sprintf(seqMsg2, "Setting to Manual Mode");
# line 1129 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 2/*seqMsg2*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	case 6:
		{
# line 1133 "../kohzuCtl.st"
			if (kohzuCtlDebug > 1)
				printf("kohzuCtl:updateRdbk:moving\n");
# line 1134 "../kohzuCtl.st"
			thetaRdbk = thetaMotRdbk;
# line 1135 "../kohzuCtl.st"
			lambdaRdbk = D * sin(thetaRdbk / radConv);
# line 1136 "../kohzuCtl.st"
			ERdbk = hc / lambdaRdbk;
# line 1137 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 25/*thetaRdbk*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1138 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 21/*lambdaRdbk*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1139 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 17/*ERdbk*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	}
}

/****** Code for state "thetaMotStopped" in state set "kohzuCtl" ******/

/* Event function for state "thetaMotStopped" in state set "kohzuCtl" */
static seqBool seqg_event_kohzuCtl_0_thetaMotStopped(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
# line 1144 "../kohzuCtl.st"
	if (causedMove)
	{
		*seqg_pnst = 2;
		*seqg_ptrn = 0;
		return TRUE;
	}
# line 1159 "../kohzuCtl.st"
	if (!causedMove)
	{
		*seqg_pnst = 9;
		*seqg_ptrn = 1;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "thetaMotStopped" in state set "kohzuCtl" */
static void seqg_action_kohzuCtl_0_thetaMotStopped(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
# line 1145 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:thetaMotStopped:causedMove (done=%d,moving=%d)\n", kohzuDone, kohzuMoving);
# line 1146 "../kohzuCtl.st"
			if (speedControl)
			{
# line 1147 "../kohzuCtl.st"
				thSpeed = oldThSpeed;
# line 1148 "../kohzuCtl.st"
				ySpeed = oldYSpeed;
# line 1149 "../kohzuCtl.st"
				zSpeed = oldZSpeed;
# line 1150 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 70/*thSpeed*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1151 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 71/*ySpeed*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1152 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 72/*zSpeed*/, DEFAULT, DEFAULT_TIMEOUT);
			}
# line 1154 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:thetaMotStopped: ySpeed = %f\n", ySpeed);
# line 1155 "../kohzuCtl.st"
			causedMove = 0;
		}
		return;
	case 1:
		{
# line 1160 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:thetaMotStopped:!causedMove (done=%d,moving=%d)\n", kohzuDone, kohzuMoving);
# line 1161 "../kohzuCtl.st"
			if (initSeqDone)
			{
# line 1162 "../kohzuCtl.st"
				opAlert = 1;
# line 1163 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 3/*opAlert*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1164 "../kohzuCtl.st"
				sprintf(seqMsg1, "Only Theta Motor Moved");
# line 1165 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1166 "../kohzuCtl.st"
				sprintf(seqMsg2, "Hit MOVE to Adjust Y & Z");
# line 1167 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 2/*seqMsg2*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1168 "../kohzuCtl.st"
				autoMode = 0;
# line 1169 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 6/*autoMode*/, DEFAULT, DEFAULT_TIMEOUT);
			}
# line 1171 "../kohzuCtl.st"
			theta = thetaMotRdbk;
# line 1172 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 22/*theta*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1173 "../kohzuCtl.st"
			lambda = D * sin(theta / radConv);
# line 1174 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 18/*lambda*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1175 "../kohzuCtl.st"
			E = hc / lambda;
# line 1176 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 14/*E*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	}
}

/****** Code for state "chkMotorLimits" in state set "kohzuCtl" ******/

/* Event function for state "chkMotorLimits" in state set "kohzuCtl" */
static seqBool seqg_event_kohzuCtl_0_chkMotorLimits(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
	if (TRUE)
	{
		*seqg_pnst = 16;
		*seqg_ptrn = 0;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "chkMotorLimits" in state set "kohzuCtl" */
static void seqg_action_kohzuCtl_0_chkMotorLimits(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
# line 1182 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:chkMotorLimits\n");
# line 1183 "../kohzuCtl.st"
			opAlert = 0;
# line 1184 "../kohzuCtl.st"
			thetaRdbk = thetaMotRdbk;
# line 1185 "../kohzuCtl.st"
			lambdaRdbk = D * sin(thetaRdbk / radConv);
# line 1186 "../kohzuCtl.st"
			ERdbk = hc / lambdaRdbk;
# line 1187 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 25/*thetaRdbk*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1188 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 21/*lambdaRdbk*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1189 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 17/*ERdbk*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1191 "../kohzuCtl.st"
			if (ccMode != 1 && ccMode != 3)
			{
# line 1192 "../kohzuCtl.st"
				if (yMotRdbk == 0)
				{
# line 1193 "../kohzuCtl.st"
					sprintf(seqMsg1, "Y Readback of 0 not reasonable");
# line 1194 "../kohzuCtl.st"
					seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1195 "../kohzuCtl.st"
					opAlert = 1;
				}
# line 1197 "../kohzuCtl.st"
				if ((yMotRdbk < yMotLoLim) || (yMotRdbk > yMotHiLim))
				{
# line 1198 "../kohzuCtl.st"
					sprintf(seqMsg1, "Y Readback outside Motor Limits");
# line 1199 "../kohzuCtl.st"
					seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1200 "../kohzuCtl.st"
					opAlert = 1;
				}
			}
# line 1203 "../kohzuCtl.st"
			if (ccMode != 1 && ccMode != 2)
			{
# line 1204 "../kohzuCtl.st"
				if (zMotRdbk == 0)
				{
# line 1205 "../kohzuCtl.st"
					sprintf(seqMsg1, "Z Readback of 0 not reasonable");
# line 1206 "../kohzuCtl.st"
					seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1207 "../kohzuCtl.st"
					opAlert = 1;
				}
# line 1209 "../kohzuCtl.st"
				if ((zMotRdbk < zMotLoLim) || (zMotRdbk > zMotHiLim))
				{
# line 1210 "../kohzuCtl.st"
					sprintf(seqMsg1, "Z Readback outside Motor Limits");
# line 1211 "../kohzuCtl.st"
					seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1212 "../kohzuCtl.st"
					opAlert = 1;
				}
			}
# line 1215 "../kohzuCtl.st"
			if (thetaMotRdbk == 0)
			{
# line 1216 "../kohzuCtl.st"
				sprintf(seqMsg1, "Theta Readback of 0 not reasonable");
# line 1217 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1218 "../kohzuCtl.st"
				opAlert = 1;
			}
# line 1220 "../kohzuCtl.st"
			if ((thetaMotRdbk < thetaMotLoLim) || (thetaMotRdbk > thetaMotHiLim))
			{
# line 1221 "../kohzuCtl.st"
				sprintf(seqMsg1, "Theta Readback outside Motor Limits");
# line 1222 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1223 "../kohzuCtl.st"
				opAlert = 1;
			}
# line 1225 "../kohzuCtl.st"
			if (opAlert)
			{
# line 1226 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 3/*opAlert*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1227 "../kohzuCtl.st"
				autoMode = 0;
# line 1228 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 6/*autoMode*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1229 "../kohzuCtl.st"
				sprintf(seqMsg2, "Set to Manual Mode");
# line 1230 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 2/*seqMsg2*/, DEFAULT, DEFAULT_TIMEOUT);
			}
		}
		return;
	}
}

/****** Code for state "chkMotorLimitsExit" in state set "kohzuCtl" ******/

/* Event function for state "chkMotorLimitsExit" in state set "kohzuCtl" */
static seqBool seqg_event_kohzuCtl_0_chkMotorLimitsExit(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
# line 1236 "../kohzuCtl.st"
	if (!opAlert)
	{
		*seqg_pnst = 2;
		*seqg_ptrn = 0;
		return TRUE;
	}
# line 1243 "../kohzuCtl.st"
	if (opAlert && seq_delay(seqg_env, 2.))
	{
		*seqg_pnst = 15;
		*seqg_ptrn = 1;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "chkMotorLimitsExit" in state set "kohzuCtl" */
static void seqg_action_kohzuCtl_0_chkMotorLimitsExit(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
# line 1237 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:chkMotorLimitsExit: OK\n");
# line 1238 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 3/*opAlert*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1239 "../kohzuCtl.st"
			sprintf(seqMsg1, "All motors within limits");
# line 1240 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 1/*seqMsg1*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	case 1:
		{
# line 1244 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:chkMotorLimitsExit: opAlert\n");
# line 1245 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 3/*opAlert*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1246 "../kohzuCtl.st"
			sprintf(seqMsg2, "Modify Motor Positions/Limits");
# line 1247 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 2/*seqMsg2*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	}
}

/****** Code for state "stopKohzu" in state set "kohzuCtl" ******/

/* Event function for state "stopKohzu" in state set "kohzuCtl" */
static seqBool seqg_event_kohzuCtl_0_stopKohzu(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
	if (TRUE)
	{
		*seqg_pnst = 18;
		*seqg_ptrn = 0;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "stopKohzu" in state set "kohzuCtl" */
static void seqg_action_kohzuCtl_0_stopKohzu(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
# line 1253 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:stopKohzu\n");
# line 1254 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 41/*thetaMotStop*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1255 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 42/*yStop*/, DEFAULT, DEFAULT_TIMEOUT);
# line 1256 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 43/*zStop*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	}
}

/****** Code for state "stoppedKohzuWait" in state set "kohzuCtl" ******/

/* Event function for state "stoppedKohzuWait" in state set "kohzuCtl" */
static seqBool seqg_event_kohzuCtl_0_stoppedKohzuWait(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
# line 1261 "../kohzuCtl.st"
	if (seq_delay(seqg_env, 1.))
	{
		*seqg_pnst = 13;
		*seqg_ptrn = 0;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "stoppedKohzuWait" in state set "kohzuCtl" */
static void seqg_action_kohzuCtl_0_stoppedKohzuWait(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
# line 1262 "../kohzuCtl.st"
			if (kohzuCtlDebug)
				printf("kohzuCtl:stoppedKohzuWait\n");
		}
		return;
	}
}

/****** Code for state "init" in state set "updatePsuedo" ******/

/* Event function for state "init" in state set "updatePsuedo" */
static seqBool seqg_event_updatePsuedo_1_init(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
	if (TRUE)
	{
		*seqg_pnst = 1;
		*seqg_ptrn = 0;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "init" in state set "updatePsuedo" */
static void seqg_action_updatePsuedo_1_init(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
		}
		return;
	}
}

/****** Code for state "update" in state set "updatePsuedo" ******/

/* Event function for state "update" in state set "updatePsuedo" */
static seqBool seqg_event_updatePsuedo_1_update(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
# line 1281 "../kohzuCtl.st"
	if (seq_efTestAndClear(seqg_env, thetaMotRdbkPseudo_mon))
	{
		*seqg_pnst = 1;
		*seqg_ptrn = 0;
		return TRUE;
	}
# line 1286 "../kohzuCtl.st"
	if (seq_efTestAndClear(seqg_env, yMotRdbk_mon))
	{
		*seqg_pnst = 1;
		*seqg_ptrn = 1;
		return TRUE;
	}
# line 1291 "../kohzuCtl.st"
	if (seq_efTestAndClear(seqg_env, zMotRdbk_mon))
	{
		*seqg_pnst = 1;
		*seqg_ptrn = 2;
		return TRUE;
	}
# line 1296 "../kohzuCtl.st"
	if (seq_efTestAndClear(seqg_env, thetaMotVel_mon))
	{
		*seqg_pnst = 1;
		*seqg_ptrn = 3;
		return TRUE;
	}
# line 1301 "../kohzuCtl.st"
	if (seq_efTestAndClear(seqg_env, yMotVel_mon))
	{
		*seqg_pnst = 1;
		*seqg_ptrn = 4;
		return TRUE;
	}
# line 1306 "../kohzuCtl.st"
	if (seq_efTestAndClear(seqg_env, zMotVel_mon))
	{
		*seqg_pnst = 1;
		*seqg_ptrn = 5;
		return TRUE;
	}
# line 1311 "../kohzuCtl.st"
	if (seq_efTestAndClear(seqg_env, thetaMotCmdMon_mon))
	{
		*seqg_pnst = 1;
		*seqg_ptrn = 6;
		return TRUE;
	}
# line 1316 "../kohzuCtl.st"
	if (seq_efTestAndClear(seqg_env, yMotCmdMon_mon))
	{
		*seqg_pnst = 1;
		*seqg_ptrn = 7;
		return TRUE;
	}
# line 1321 "../kohzuCtl.st"
	if (seq_efTestAndClear(seqg_env, zMotCmdMon_mon))
	{
		*seqg_pnst = 1;
		*seqg_ptrn = 8;
		return TRUE;
	}
# line 1326 "../kohzuCtl.st"
	if (seq_efTestAndClear(seqg_env, thetaDmov_mon))
	{
		*seqg_pnst = 1;
		*seqg_ptrn = 9;
		return TRUE;
	}
# line 1331 "../kohzuCtl.st"
	if (seq_efTestAndClear(seqg_env, yDmov_mon))
	{
		*seqg_pnst = 1;
		*seqg_ptrn = 10;
		return TRUE;
	}
# line 1336 "../kohzuCtl.st"
	if (seq_efTestAndClear(seqg_env, zDmov_mon))
	{
		*seqg_pnst = 1;
		*seqg_ptrn = 11;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "update" in state set "updatePsuedo" */
static void seqg_action_updatePsuedo_1_update(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
# line 1282 "../kohzuCtl.st"
			thetaMotRdbkEcho = thetaMotRdbk;
# line 1283 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 32/*thetaMotRdbkEcho*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	case 1:
		{
# line 1287 "../kohzuCtl.st"
			yMotRdbkEcho = yMotRdbk;
# line 1288 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 33/*yMotRdbkEcho*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	case 2:
		{
# line 1292 "../kohzuCtl.st"
			zMotRdbkEcho = zMotRdbk;
# line 1293 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 34/*zMotRdbkEcho*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	case 3:
		{
# line 1297 "../kohzuCtl.st"
			thetaMotVelEcho = thSpeed;
# line 1298 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 35/*thetaMotVelEcho*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	case 4:
		{
# line 1302 "../kohzuCtl.st"
			yMotVelEcho = ySpeed;
# line 1303 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 36/*yMotVelEcho*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	case 5:
		{
# line 1307 "../kohzuCtl.st"
			zMotVelEcho = zSpeed;
# line 1308 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 37/*zMotVelEcho*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	case 6:
		{
# line 1312 "../kohzuCtl.st"
			thetaMotCmdEcho = thetaMotCmdMon;
# line 1313 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 29/*thetaMotCmdEcho*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	case 7:
		{
# line 1317 "../kohzuCtl.st"
			yMotCmdEcho = yMotCmdMon;
# line 1318 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 30/*yMotCmdEcho*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	case 8:
		{
# line 1322 "../kohzuCtl.st"
			zMotCmdEcho = zMotCmdMon;
# line 1323 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 31/*zMotCmdEcho*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	case 9:
		{
# line 1327 "../kohzuCtl.st"
			thetaDmovEcho = thetaDmov;
# line 1328 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 38/*thetaDmovEcho*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	case 10:
		{
# line 1332 "../kohzuCtl.st"
			yDmovEcho = yDmov;
# line 1333 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 39/*yDmovEcho*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	case 11:
		{
# line 1337 "../kohzuCtl.st"
			zDmovEcho = zDmov;
# line 1338 "../kohzuCtl.st"
			seq_pvPutTmo(seqg_env, 40/*zDmovEcho*/, DEFAULT, DEFAULT_TIMEOUT);
		}
		return;
	}
}

/****** Code for state "init" in state set "updateSet" ******/

/* Event function for state "init" in state set "updateSet" */
static seqBool seqg_event_updateSet_2_init(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
	if (TRUE)
	{
		*seqg_pnst = 1;
		*seqg_ptrn = 0;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "init" in state set "updateSet" */
static void seqg_action_updateSet_2_init(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
		}
		return;
	}
}

/****** Code for state "update" in state set "updateSet" ******/

/* Event function for state "update" in state set "updateSet" */
static seqBool seqg_event_updateSet_2_update(SS_ID seqg_env, int *seqg_ptrn, int *seqg_pnst)
{
# line 1356 "../kohzuCtl.st"
	if (seq_efTestAndClear(seqg_env, useSetMode_mon))
	{
		*seqg_pnst = 1;
		*seqg_ptrn = 0;
		return TRUE;
	}
# line 1371 "../kohzuCtl.st"
	if (seq_efTestAndClear(seqg_env, thetaMotSet_mon))
	{
		*seqg_pnst = 1;
		*seqg_ptrn = 1;
		return TRUE;
	}
# line 1378 "../kohzuCtl.st"
	if (seq_efTestAndClear(seqg_env, yMotSet_mon))
	{
		*seqg_pnst = 1;
		*seqg_ptrn = 2;
		return TRUE;
	}
# line 1385 "../kohzuCtl.st"
	if (seq_efTestAndClear(seqg_env, zMotSet_mon))
	{
		*seqg_pnst = 1;
		*seqg_ptrn = 3;
		return TRUE;
	}
	return FALSE;
}

/* Action function for state "update" in state set "updateSet" */
static void seqg_action_updateSet_2_update(SS_ID seqg_env, int seqg_trn, int *seqg_pnst)
{
	switch(seqg_trn)
	{
	case 0:
		{
# line 1357 "../kohzuCtl.st"
			if (thetaMotSet != useSetMode)
			{
# line 1358 "../kohzuCtl.st"
				thetaMotSet = useSetMode;
# line 1359 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 78/*thetaMotSet*/, DEFAULT, DEFAULT_TIMEOUT);
			}
# line 1361 "../kohzuCtl.st"
			if (yMotSet != useSetMode)
			{
# line 1362 "../kohzuCtl.st"
				yMotSet = useSetMode;
# line 1363 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 79/*yMotSet*/, DEFAULT, DEFAULT_TIMEOUT);
			}
# line 1365 "../kohzuCtl.st"
			if (zMotSet != useSetMode)
			{
# line 1366 "../kohzuCtl.st"
				zMotSet = useSetMode;
# line 1367 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 80/*zMotSet*/, DEFAULT, DEFAULT_TIMEOUT);
			}
		}
		return;
	case 1:
		{
# line 1372 "../kohzuCtl.st"
			if (useSetMode != thetaMotSet)
			{
# line 1373 "../kohzuCtl.st"
				useSetMode = thetaMotSet;
# line 1374 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 77/*useSetMode*/, DEFAULT, DEFAULT_TIMEOUT);
			}
		}
		return;
	case 2:
		{
# line 1379 "../kohzuCtl.st"
			if (useSetMode != yMotSet)
			{
# line 1380 "../kohzuCtl.st"
				useSetMode = yMotSet;
# line 1381 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 77/*useSetMode*/, DEFAULT, DEFAULT_TIMEOUT);
			}
		}
		return;
	case 3:
		{
# line 1386 "../kohzuCtl.st"
			if (useSetMode != zMotSet)
			{
# line 1387 "../kohzuCtl.st"
				useSetMode = zMotSet;
# line 1388 "../kohzuCtl.st"
				seq_pvPutTmo(seqg_env, 77/*useSetMode*/, DEFAULT, DEFAULT_TIMEOUT);
			}
		}
		return;
	}
}

#undef seqg_var

/************************ Tables ************************/

/* Channel table */
static seqChan seqg_chans[] = {
	/* chName, offset, varName, varType, count, eventNum, efId, monitored, queueSize, queueIndex */
	{"{P}KohzuCtlDebug", (size_t)&kohzuCtlDebug, "kohzuCtlDebug", P_SHORT, 1, 28, 0, 1, 0, 0},
	{"{P}KohzuSeqMsg1SI", (size_t)&seqMsg1, "seqMsg1", P_STRING, 1, 29, 0, 0, 0, 0},
	{"{P}KohzuSeqMsg2SI", (size_t)&seqMsg2, "seqMsg2", P_STRING, 1, 30, 0, 0, 0, 0},
	{"{P}KohzuAlertBO", (size_t)&opAlert, "opAlert", P_SHORT, 1, 31, 0, 0, 0, 0},
	{"{P}KohzuOperAckBO", (size_t)&opAck, "opAck", P_SHORT, 1, 32, 0, 1, 0, 0},
	{"{P}KohzuPutBO", (size_t)&putVals, "putVals", P_SHORT, 1, 33, 0, 1, 0, 0},
	{"{P}KohzuModeBO", (size_t)&autoMode, "autoMode", P_SHORT, 1, 34, 0, 1, 0, 0},
	{"{P}KohzuMode2MO", (size_t)&ccMode, "ccMode", P_SHORT, 1, 35, 0, 1, 0, 0},
	{"{P}KohzuMoving", (size_t)&kohzuMoving, "kohzuMoving", P_SHORT, 1, 36, 0, 1, 0, 0},
	{"{P}BraggHAO", (size_t)&H, "H", P_DOUBLE, 1, 37, 1, 1, 0, 0},
	{"{P}BraggKAO", (size_t)&K, "K", P_DOUBLE, 1, 38, 2, 1, 0, 0},
	{"{P}BraggLAO", (size_t)&L, "L", P_DOUBLE, 1, 39, 3, 1, 0, 0},
	{"{P}BraggAAO", (size_t)&A, "A", P_DOUBLE, 1, 40, 4, 1, 0, 0},
	{"{P}Bragg2dSpacingAO", (size_t)&D, "D", P_DOUBLE, 1, 41, 0, 0, 0, 0},
	{"{P}BraggEAO", (size_t)&E, "E", P_DOUBLE, 1, 42, 5, 1, 0, 0},
	{"{P}BraggEAO.DRVH", (size_t)&EHi, "EHi", P_DOUBLE, 1, 43, 0, 0, 0, 0},
	{"{P}BraggEAO.DRVL", (size_t)&ELo, "ELo", P_DOUBLE, 1, 44, 0, 0, 0, 0},
	{"{P}BraggERdbkAO", (size_t)&ERdbk, "ERdbk", P_DOUBLE, 1, 45, 0, 0, 0, 0},
	{"{P}BraggLambdaAO", (size_t)&lambda, "lambda", P_DOUBLE, 1, 46, 6, 1, 0, 0},
	{"{P}BraggLambdaAO.DRVH", (size_t)&lambdaHi, "lambdaHi", P_DOUBLE, 1, 47, 0, 0, 0, 0},
	{"{P}BraggLambdaAO.DRVL", (size_t)&lambdaLo, "lambdaLo", P_DOUBLE, 1, 48, 0, 0, 0, 0},
	{"{P}BraggLambdaRdbkAO", (size_t)&lambdaRdbk, "lambdaRdbk", P_DOUBLE, 1, 49, 0, 0, 0, 0},
	{"{P}BraggThetaAO", (size_t)&theta, "theta", P_DOUBLE, 1, 50, 7, 1, 0, 0},
	{"{P}BraggThetaAO.DRVH", (size_t)&thetaHi, "thetaHi", P_DOUBLE, 1, 51, 0, 0, 0, 0},
	{"{P}BraggThetaAO.DRVL", (size_t)&thetaLo, "thetaLo", P_DOUBLE, 1, 52, 0, 0, 0, 0},
	{"{P}BraggThetaRdbkAO", (size_t)&thetaRdbk, "thetaRdbk", P_DOUBLE, 1, 53, 0, 0, 0, 0},
	{"{P}KohzuThetaPvSI", (size_t)&thetaMotName, "thetaMotName", P_STRING, 1, 54, 0, 0, 0, 0},
	{"{P}KohzuYPvSI", (size_t)&yMotName, "yMotName", P_STRING, 1, 55, 0, 0, 0, 0},
	{"{P}KohzuZPvSI", (size_t)&zMotName, "zMotName", P_STRING, 1, 56, 0, 0, 0, 0},
	{"{P}KohzuThetaCmdAO", (size_t)&thetaMotCmdEcho, "thetaMotCmdEcho", P_DOUBLE, 1, 57, 0, 0, 0, 0},
	{"{P}KohzuYCmdAO", (size_t)&yMotCmdEcho, "yMotCmdEcho", P_DOUBLE, 1, 58, 0, 0, 0, 0},
	{"{P}KohzuZCmdAO", (size_t)&zMotCmdEcho, "zMotCmdEcho", P_DOUBLE, 1, 59, 0, 0, 0, 0},
	{"{P}KohzuThetaRdbkAI", (size_t)&thetaMotRdbkEcho, "thetaMotRdbkEcho", P_DOUBLE, 1, 60, 0, 0, 0, 0},
	{"{P}KohzuYRdbkAI", (size_t)&yMotRdbkEcho, "yMotRdbkEcho", P_DOUBLE, 1, 61, 0, 0, 0, 0},
	{"{P}KohzuZRdbkAI", (size_t)&zMotRdbkEcho, "zMotRdbkEcho", P_DOUBLE, 1, 62, 0, 0, 0, 0},
	{"{P}KohzuThetaVelAI", (size_t)&thetaMotVelEcho, "thetaMotVelEcho", P_DOUBLE, 1, 63, 0, 0, 0, 0},
	{"{P}KohzuYVelAI", (size_t)&yMotVelEcho, "yMotVelEcho", P_DOUBLE, 1, 64, 0, 0, 0, 0},
	{"{P}KohzuZVelAI", (size_t)&zMotVelEcho, "zMotVelEcho", P_DOUBLE, 1, 65, 0, 0, 0, 0},
	{"{P}KohzuThetaDmovBI", (size_t)&thetaDmovEcho, "thetaDmovEcho", P_SHORT, 1, 66, 0, 0, 0, 0},
	{"{P}KohzuYDmovBI", (size_t)&yDmovEcho, "yDmovEcho", P_SHORT, 1, 67, 0, 0, 0, 0},
	{"{P}KohzuZDmovBI", (size_t)&zDmovEcho, "zDmovEcho", P_SHORT, 1, 68, 0, 0, 0, 0},
	{"{P}{M_THETA}.STOP", (size_t)&thetaMotStop, "thetaMotStop", P_SHORT, 1, 69, 0, 0, 0, 0},
	{"{P}{M_Y}.STOP", (size_t)&yStop, "yStop", P_SHORT, 1, 70, 0, 0, 0, 0},
	{"{P}{M_Z}.STOP", (size_t)&zStop, "zStop", P_SHORT, 1, 71, 0, 0, 0, 0},
	{"{P}{M_THETA}.DMOV", (size_t)&thetaDmov, "thetaDmov", P_SHORT, 1, 72, 8, 1, 0, 0},
	{"{P}{M_Y}.DMOV", (size_t)&yDmov, "yDmov", P_SHORT, 1, 73, 9, 1, 0, 0},
	{"{P}{M_Z}.DMOV", (size_t)&zDmov, "zDmov", P_SHORT, 1, 74, 10, 1, 0, 0},
	{"{P}{M_THETA}.HLS", (size_t)&thetaHls, "thetaHls", P_SHORT, 1, 75, 0, 1, 0, 0},
	{"{P}{M_THETA}.LLS", (size_t)&thetaLls, "thetaLls", P_SHORT, 1, 76, 0, 1, 0, 0},
	{"{P}{M_Y}.HLS", (size_t)&yHls, "yHls", P_SHORT, 1, 77, 0, 1, 0, 0},
	{"{P}{M_Y}.LLS", (size_t)&yLls, "yLls", P_SHORT, 1, 78, 0, 1, 0, 0},
	{"{P}{M_Z}.HLS", (size_t)&zHls, "zHls", P_SHORT, 1, 79, 0, 1, 0, 0},
	{"{P}{M_Z}.LLS", (size_t)&zLls, "zLls", P_SHORT, 1, 80, 0, 1, 0, 0},
	{"{P}KohzuThetaSetAO", (size_t)&thetaMotDesired, "thetaMotDesired", P_DOUBLE, 1, 81, 0, 1, 0, 0},
	{"{P}KohzuYSetAO", (size_t)&yMotDesired, "yMotDesired", P_DOUBLE, 1, 82, 0, 1, 0, 0},
	{"{P}KohzuYSetAO.DRVH", (size_t)&yMotDesiredHi, "yMotDesiredHi", P_DOUBLE, 1, 83, 0, 0, 0, 0},
	{"{P}KohzuYSetAO.DRVL", (size_t)&yMotDesiredLo, "yMotDesiredLo", P_DOUBLE, 1, 84, 0, 0, 0, 0},
	{"{P}KohzuZSetAO", (size_t)&zMotDesired, "zMotDesired", P_DOUBLE, 1, 85, 0, 1, 0, 0},
	{"{P}{M_THETA}.HLM", (size_t)&thetaMotHiLim, "thetaMotHiLim", P_DOUBLE, 1, 86, 11, 1, 0, 0},
	{"{P}{M_THETA}.LLM", (size_t)&thetaMotLoLim, "thetaMotLoLim", P_DOUBLE, 1, 87, 12, 1, 0, 0},
	{"{P}{M_Y}.HLM", (size_t)&yMotHiLim, "yMotHiLim", P_DOUBLE, 1, 88, 0, 1, 0, 0},
	{"{P}{M_Y}.LLM", (size_t)&yMotLoLim, "yMotLoLim", P_DOUBLE, 1, 89, 0, 1, 0, 0},
	{"{P}{M_Z}.HLM", (size_t)&zMotHiLim, "zMotHiLim", P_DOUBLE, 1, 90, 0, 1, 0, 0},
	{"{P}{M_Z}.LLM", (size_t)&zMotLoLim, "zMotLoLim", P_DOUBLE, 1, 91, 0, 1, 0, 0},
	{"{P}{M_THETA}", (size_t)&thetaMotCmd, "thetaMotCmd", P_DOUBLE, 1, 92, 0, 0, 0, 0},
	{"{P}{M_Y}", (size_t)&yMotCmd, "yMotCmd", P_DOUBLE, 1, 93, 0, 0, 0, 0},
	{"{P}{M_Z}", (size_t)&zMotCmd, "zMotCmd", P_DOUBLE, 1, 94, 0, 0, 0, 0},
	{"{P}{M_THETA}", (size_t)&thetaMotCmdMon, "thetaMotCmdMon", P_DOUBLE, 1, 95, 13, 1, 0, 0},
	{"{P}{M_Y}", (size_t)&yMotCmdMon, "yMotCmdMon", P_DOUBLE, 1, 96, 14, 1, 0, 0},
	{"{P}{M_Z}", (size_t)&zMotCmdMon, "zMotCmdMon", P_DOUBLE, 1, 97, 15, 1, 0, 0},
	{"{P}{M_THETA}.VELO", (size_t)&thSpeed, "thSpeed", P_DOUBLE, 1, 98, 16, 1, 0, 0},
	{"{P}{M_Y}.VELO", (size_t)&ySpeed, "ySpeed", P_DOUBLE, 1, 99, 17, 1, 0, 0},
	{"{P}{M_Z}.VELO", (size_t)&zSpeed, "zSpeed", P_DOUBLE, 1, 100, 18, 1, 0, 0},
	{"{P}KohzuSpeedCtrl", (size_t)&speedControl, "speedControl", P_SHORT, 1, 101, 0, 1, 0, 0},
	{"{P}{M_THETA}.RBV", (size_t)&thetaMotRdbk, "thetaMotRdbk", P_DOUBLE, 1, 102, 19, 1, 0, 0},
	{"{P}{M_Y}.RBV", (size_t)&yMotRdbk, "yMotRdbk", P_DOUBLE, 1, 103, 21, 1, 0, 0},
	{"{P}{M_Z}.RBV", (size_t)&zMotRdbk, "zMotRdbk", P_DOUBLE, 1, 104, 22, 1, 0, 0},
	{"{P}KohzuUseSetBO", (size_t)&useSetMode, "useSetMode", P_SHORT, 1, 105, 23, 1, 0, 0},
	{"{P}{M_THETA}.SET", (size_t)&thetaMotSet, "thetaMotSet", P_SHORT, 1, 106, 24, 1, 0, 0},
	{"{P}{M_Y}.SET", (size_t)&yMotSet, "yMotSet", P_SHORT, 1, 107, 25, 1, 0, 0},
	{"{P}{M_Z}.SET", (size_t)&zMotSet, "zMotSet", P_SHORT, 1, 108, 26, 1, 0, 0},
	{"{P}BraggETweakAI", (size_t)&ETweakVal, "ETweakVal", P_DOUBLE, 1, 109, 0, 1, 0, 0},
	{"{P}BraggEIncBO", (size_t)&ETweakInc, "ETweakInc", P_SHORT, 1, 110, 0, 1, 0, 0},
	{"{P}BraggEDecBO", (size_t)&ETweakDec, "ETweakDec", P_SHORT, 1, 111, 0, 1, 0, 0},
	{"{P}BraggLambdaTweakAI", (size_t)&LTweakVal, "LTweakVal", P_DOUBLE, 1, 112, 0, 1, 0, 0},
	{"{P}BraggLambdaIncBO", (size_t)&LTweakInc, "LTweakInc", P_SHORT, 1, 113, 0, 1, 0, 0},
	{"{P}BraggLambdaDecBO", (size_t)&LTweakDec, "LTweakDec", P_SHORT, 1, 114, 0, 1, 0, 0},
	{"{P}BraggThetaTweakAI", (size_t)&thTweakVal, "thTweakVal", P_DOUBLE, 1, 115, 0, 1, 0, 0},
	{"{P}BraggThetaIncBO", (size_t)&thTweakInc, "thTweakInc", P_SHORT, 1, 116, 0, 1, 0, 0},
	{"{P}BraggThetaDecBO", (size_t)&thTweakDec, "thTweakDec", P_SHORT, 1, 117, 0, 1, 0, 0},
	{"{P}Kohzu_yOffsetAO", (size_t)&yOffset, "yOffset", P_DOUBLE, 1, 118, 27, 1, 0, 0},
	{"{P}Kohzu_yOffsetAO.DRVH", (size_t)&yOffsetHi, "yOffsetHi", P_DOUBLE, 1, 119, 0, 0, 0, 0},
	{"{P}Kohzu_yOffsetAO.DRVL", (size_t)&yOffsetLo, "yOffsetLo", P_DOUBLE, 1, 120, 0, 0, 0, 0},
};

/* Event masks for state set "kohzuCtl" */
static const seqMask seqg_mask_kohzuCtl_0_init[] = {
	0x00000000,
	0x00000000,
	0x00000000,
	0x00000000,
};
static const seqMask seqg_mask_kohzuCtl_0_initSequence[] = {
	0x00000000,
	0x00000000,
	0x00000000,
	0x00000000,
};
static const seqMask seqg_mask_kohzuCtl_0_waitForCmndEnter[] = {
	0x00000000,
	0x00000000,
	0x00000000,
	0x00000000,
};
static const seqMask seqg_mask_kohzuCtl_0_waitForCmnd[] = {
	0x080818fe,
	0x00000003,
	0x00000000,
	0x0036c000,
};
static const seqMask seqg_mask_kohzuCtl_0_tweak[] = {
	0x00000000,
	0x00000000,
	0x00000000,
	0x0036c000,
};
static const seqMask seqg_mask_kohzuCtl_0_dInputChanged[] = {
	0x00000000,
	0x00000000,
	0x00000000,
	0x00000000,
};
static const seqMask seqg_mask_kohzuCtl_0_thetaLimits[] = {
	0x00000000,
	0x00000000,
	0x00000000,
	0x00000000,
};
static const seqMask seqg_mask_kohzuCtl_0_eChanged[] = {
	0x00000000,
	0x00000000,
	0x00000000,
	0x00000000,
};
static const seqMask seqg_mask_kohzuCtl_0_lChanged[] = {
	0x00000000,
	0x00004200,
	0x00000000,
	0x00000000,
};
static const seqMask seqg_mask_kohzuCtl_0_thChanged[] = {
	0x00000000,
	0x00000000,
	0x00000000,
	0x00000000,
};
static const seqMask seqg_mask_kohzuCtl_0_calcMovements[] = {
	0x00000000,
	0x00000000,
	0x00000000,
	0x00000000,
};
static const seqMask seqg_mask_kohzuCtl_0_moveKohzu[] = {
	0x00000000,
	0x00000006,
	0x00000000,
	0x00000200,
};
static const seqMask seqg_mask_kohzuCtl_0_checkDone[] = {
	0x00000000,
	0x00000000,
	0x00000700,
	0x00000000,
};
static const seqMask seqg_mask_kohzuCtl_0_updateRdbk[] = {
	0x00000000,
	0x00000008,
	0x0001ff00,
	0x00000040,
};
static const seqMask seqg_mask_kohzuCtl_0_thetaMotStopped[] = {
	0x00000000,
	0x00000000,
	0x00000000,
	0x00000000,
};
static const seqMask seqg_mask_kohzuCtl_0_chkMotorLimits[] = {
	0x00000000,
	0x00000000,
	0x00000000,
	0x00000000,
};
static const seqMask seqg_mask_kohzuCtl_0_chkMotorLimitsExit[] = {
	0x80000000,
	0x00000000,
	0x00000000,
	0x00000000,
};
static const seqMask seqg_mask_kohzuCtl_0_stopKohzu[] = {
	0x00000000,
	0x00000000,
	0x00000000,
	0x00000000,
};
static const seqMask seqg_mask_kohzuCtl_0_stoppedKohzuWait[] = {
	0x00000000,
	0x00000000,
	0x00000000,
	0x00000000,
};

/* State table for state set "kohzuCtl" */
static seqState seqg_states_kohzuCtl[] = {
	{
	/* state name */        "init",
	/* action function */   seqg_action_kohzuCtl_0_init,
	/* event function */    seqg_event_kohzuCtl_0_init,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_kohzuCtl_0_init,
	/* state options */     (0)
	},
	{
	/* state name */        "initSequence",
	/* action function */   seqg_action_kohzuCtl_0_initSequence,
	/* event function */    seqg_event_kohzuCtl_0_initSequence,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_kohzuCtl_0_initSequence,
	/* state options */     (0)
	},
	{
	/* state name */        "waitForCmndEnter",
	/* action function */   seqg_action_kohzuCtl_0_waitForCmndEnter,
	/* event function */    seqg_event_kohzuCtl_0_waitForCmndEnter,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_kohzuCtl_0_waitForCmndEnter,
	/* state options */     (0)
	},
	{
	/* state name */        "waitForCmnd",
	/* action function */   seqg_action_kohzuCtl_0_waitForCmnd,
	/* event function */    seqg_event_kohzuCtl_0_waitForCmnd,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_kohzuCtl_0_waitForCmnd,
	/* state options */     (0)
	},
	{
	/* state name */        "tweak",
	/* action function */   seqg_action_kohzuCtl_0_tweak,
	/* event function */    seqg_event_kohzuCtl_0_tweak,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_kohzuCtl_0_tweak,
	/* state options */     (0)
	},
	{
	/* state name */        "dInputChanged",
	/* action function */   seqg_action_kohzuCtl_0_dInputChanged,
	/* event function */    seqg_event_kohzuCtl_0_dInputChanged,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_kohzuCtl_0_dInputChanged,
	/* state options */     (0)
	},
	{
	/* state name */        "thetaLimits",
	/* action function */   seqg_action_kohzuCtl_0_thetaLimits,
	/* event function */    seqg_event_kohzuCtl_0_thetaLimits,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_kohzuCtl_0_thetaLimits,
	/* state options */     (0)
	},
	{
	/* state name */        "eChanged",
	/* action function */   seqg_action_kohzuCtl_0_eChanged,
	/* event function */    seqg_event_kohzuCtl_0_eChanged,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_kohzuCtl_0_eChanged,
	/* state options */     (0)
	},
	{
	/* state name */        "lChanged",
	/* action function */   seqg_action_kohzuCtl_0_lChanged,
	/* event function */    seqg_event_kohzuCtl_0_lChanged,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_kohzuCtl_0_lChanged,
	/* state options */     (0)
	},
	{
	/* state name */        "thChanged",
	/* action function */   seqg_action_kohzuCtl_0_thChanged,
	/* event function */    seqg_event_kohzuCtl_0_thChanged,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_kohzuCtl_0_thChanged,
	/* state options */     (0)
	},
	{
	/* state name */        "calcMovements",
	/* action function */   seqg_action_kohzuCtl_0_calcMovements,
	/* event function */    seqg_event_kohzuCtl_0_calcMovements,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_kohzuCtl_0_calcMovements,
	/* state options */     (0)
	},
	{
	/* state name */        "moveKohzu",
	/* action function */   seqg_action_kohzuCtl_0_moveKohzu,
	/* event function */    seqg_event_kohzuCtl_0_moveKohzu,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_kohzuCtl_0_moveKohzu,
	/* state options */     (0)
	},
	{
	/* state name */        "checkDone",
	/* action function */   seqg_action_kohzuCtl_0_checkDone,
	/* event function */    seqg_event_kohzuCtl_0_checkDone,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_kohzuCtl_0_checkDone,
	/* state options */     (0)
	},
	{
	/* state name */        "updateRdbk",
	/* action function */   seqg_action_kohzuCtl_0_updateRdbk,
	/* event function */    seqg_event_kohzuCtl_0_updateRdbk,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_kohzuCtl_0_updateRdbk,
	/* state options */     (0)
	},
	{
	/* state name */        "thetaMotStopped",
	/* action function */   seqg_action_kohzuCtl_0_thetaMotStopped,
	/* event function */    seqg_event_kohzuCtl_0_thetaMotStopped,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_kohzuCtl_0_thetaMotStopped,
	/* state options */     (0)
	},
	{
	/* state name */        "chkMotorLimits",
	/* action function */   seqg_action_kohzuCtl_0_chkMotorLimits,
	/* event function */    seqg_event_kohzuCtl_0_chkMotorLimits,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_kohzuCtl_0_chkMotorLimits,
	/* state options */     (0)
	},
	{
	/* state name */        "chkMotorLimitsExit",
	/* action function */   seqg_action_kohzuCtl_0_chkMotorLimitsExit,
	/* event function */    seqg_event_kohzuCtl_0_chkMotorLimitsExit,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_kohzuCtl_0_chkMotorLimitsExit,
	/* state options */     (0)
	},
	{
	/* state name */        "stopKohzu",
	/* action function */   seqg_action_kohzuCtl_0_stopKohzu,
	/* event function */    seqg_event_kohzuCtl_0_stopKohzu,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_kohzuCtl_0_stopKohzu,
	/* state options */     (0)
	},
	{
	/* state name */        "stoppedKohzuWait",
	/* action function */   seqg_action_kohzuCtl_0_stoppedKohzuWait,
	/* event function */    seqg_event_kohzuCtl_0_stoppedKohzuWait,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_kohzuCtl_0_stoppedKohzuWait,
	/* state options */     (0)
	},
};

/* Event masks for state set "updatePsuedo" */
static const seqMask seqg_mask_updatePsuedo_1_init[] = {
	0x00000000,
	0x00000000,
	0x00000000,
	0x00000000,
};
static const seqMask seqg_mask_updatePsuedo_1_update[] = {
	0x0077e700,
	0x00000000,
	0x00000000,
	0x00000000,
};

/* State table for state set "updatePsuedo" */
static seqState seqg_states_updatePsuedo[] = {
	{
	/* state name */        "init",
	/* action function */   seqg_action_updatePsuedo_1_init,
	/* event function */    seqg_event_updatePsuedo_1_init,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_updatePsuedo_1_init,
	/* state options */     (0)
	},
	{
	/* state name */        "update",
	/* action function */   seqg_action_updatePsuedo_1_update,
	/* event function */    seqg_event_updatePsuedo_1_update,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_updatePsuedo_1_update,
	/* state options */     (0)
	},
};

/* Event masks for state set "updateSet" */
static const seqMask seqg_mask_updateSet_2_init[] = {
	0x00000000,
	0x00000000,
	0x00000000,
	0x00000000,
};
static const seqMask seqg_mask_updateSet_2_update[] = {
	0x07800000,
	0x00000000,
	0x00000000,
	0x00000000,
};

/* State table for state set "updateSet" */
static seqState seqg_states_updateSet[] = {
	{
	/* state name */        "init",
	/* action function */   seqg_action_updateSet_2_init,
	/* event function */    seqg_event_updateSet_2_init,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_updateSet_2_init,
	/* state options */     (0)
	},
	{
	/* state name */        "update",
	/* action function */   seqg_action_updateSet_2_update,
	/* event function */    seqg_event_updateSet_2_update,
	/* entry function */    0,
	/* exit function */     0,
	/* event mask array */  seqg_mask_updateSet_2_update,
	/* state options */     (0)
	},
};

/* State set table */
static seqSS seqg_statesets[] = {
	{
	/* state set name */    "kohzuCtl",
	/* states */            seqg_states_kohzuCtl,
	/* number of states */  19
	},

	{
	/* state set name */    "updatePsuedo",
	/* states */            seqg_states_updatePsuedo,
	/* number of states */  2
	},

	{
	/* state set name */    "updateSet",
	/* states */            seqg_states_updateSet,
	/* number of states */  2
	},
};

/* Program table (global) */
seqProgram kohzuCtl = {
	/* magic number */      2002005,
	/* program name */      "kohzuCtl",
	/* channels */          seqg_chans,
	/* num. channels */     93,
	/* state sets */        seqg_statesets,
	/* num. state sets */   3,
	/* user var size */     0,
	/* param */             "P=nda, M_THETA=m9, M_Y=m10, M_Z=m11, GEOM=1",
	/* num. event flags */  27,
	/* encoded options */   (0 | OPT_CONN | OPT_NEWEF),
	/* init func */         seqg_init,
	/* entry func */        0,
	/* exit func */         0,
	/* num. queues */       0
};
# line 1398 "../kohzuCtl.st"



double kohzuCtl_calc2dSpacing()
{

 double result;

 result = (2*A)/sqrt(H*H + K*K + L*L);


 opAlert = 0;
 if (((fmod(H,2)) != (fmod(K,2))) || ((fmod(H,2)) != (fmod(L,2))))
  opAlert = 1;
 avg = (H+K+L)/2.0;
 nint = (int)((avg)>0 ? (avg)+0.5 : (avg)-0.5);
 if ((fabs(avg-nint) <= .25) && (fmod(nint,2)))
  opAlert = 1;
 if (opAlert) {
  sprintf(seqMsg1, "(H,K,L) is 'forbidden' reflection");
 } else {
  sprintf(seqMsg1, "New d spacing");
 }
 return(result);
}




/* Register sequencer commands and program */
#include "epicsExport.h"
static void kohzuCtlRegistrar (void) {
    seqRegisterSequencerCommands();
    seqRegisterSequencerProgram (&kohzuCtl);
}
epicsExportRegistrar(kohzuCtlRegistrar);
